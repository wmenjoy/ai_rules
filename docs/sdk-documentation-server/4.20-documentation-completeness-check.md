# 4.20 æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥

## 4.20.1 ä»£ç æ³¨é‡Šå®Œæ•´æ€§

### 4.20.1.1 ç±»å’Œæ–¹æ³•æ³¨é‡Šæ£€æŸ¥ ğŸ”´

**1. æ£€æµ‹ç›®æ ‡**

a. æ‰€æœ‰å…¬å…±ç±»å’Œæ–¹æ³•éƒ½æœ‰JavaDocæ³¨é‡Š
b. æ³¨é‡Šå†…å®¹å‡†ç¡®æè¿°åŠŸèƒ½å’Œç”¨é€”
c. åŒ…å«å¿…è¦çš„å‚æ•°ã€è¿”å›å€¼å’Œå¼‚å¸¸è¯´æ˜

**2. æ£€æµ‹æ–¹æ³•**

1. JavaDocæ£€æŸ¥å·¥å…·
2. SonarQubeæ³¨é‡Šè¦†ç›–ç‡æ£€æŸ¥
3. é™æ€ä»£ç åˆ†æ
4. ä»£ç å®¡æŸ¥

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ ç¼ºå°‘æ³¨é‡Šæˆ–æ³¨é‡Šä¸å®Œæ•´
public class UserService {
    
    // æ²¡æœ‰ç±»çº§åˆ«æ³¨é‡Š
    
    public User createUser(String name, String email) {
        // æ²¡æœ‰æ–¹æ³•æ³¨é‡Š
        validateInput(name, email);
        return userRepository.save(new User(name, email));
    }
    
    public List<User> findUsers(String keyword, int page, int size) {
        // æ²¡æœ‰è¯´æ˜å‚æ•°å«ä¹‰å’Œè¿”å›å€¼
        return userRepository.findByKeyword(keyword, page, size);
    }
    
    public void deleteUser(Long id) throws UserNotFoundException {
        // æ²¡æœ‰è¯´æ˜å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
        userRepository.deleteById(id);
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
/**
 * ç”¨æˆ·æœåŠ¡ç±»ï¼Œæä¾›ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡æ“ä½œ
 * 
 * <p>è¯¥æœåŠ¡ç±»å°è£…äº†ç”¨æˆ·çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤ç­‰æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œ
 * å¹¶å¤„ç†ç›¸å…³çš„ä¸šåŠ¡è§„åˆ™éªŒè¯å’Œå¼‚å¸¸æƒ…å†µã€‚</p>
 * 
 * @author å¼€å‘è€…å§“å
 * @version 1.0
 * @since 2024-01-01
 */
public class UserService {
    
    /**
     * åˆ›å»ºæ–°ç”¨æˆ·
     * 
     * <p>æ ¹æ®æä¾›çš„ç”¨æˆ·åå’Œé‚®ç®±åˆ›å»ºæ–°ç”¨æˆ·ï¼Œä¼šè¿›è¡Œè¾“å…¥éªŒè¯
     * å’Œé‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥ã€‚</p>
     * 
     * @param name ç”¨æˆ·åï¼Œä¸èƒ½ä¸ºç©ºä¸”é•¿åº¦åœ¨2-50å­—ç¬¦ä¹‹é—´
     * @param email ç”¨æˆ·é‚®ç®±ï¼Œå¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼ä¸”åœ¨ç³»ç»Ÿä¸­å”¯ä¸€
     * @return åˆ›å»ºæˆåŠŸçš„ç”¨æˆ·å¯¹è±¡ï¼ŒåŒ…å«ç”Ÿæˆçš„ç”¨æˆ·ID
     * @throws IllegalArgumentException å½“è¾“å…¥å‚æ•°ä¸ç¬¦åˆè¦æ±‚æ—¶
     * @throws EmailAlreadyExistsException å½“é‚®ç®±å·²å­˜åœ¨æ—¶
     */
    public User createUser(String name, String email) {
        validateInput(name, email);
        checkEmailUniqueness(email);
        
        User user = User.builder()
            .name(name)
            .email(email)
            .createdAt(Instant.now())
            .status(UserStatus.ACTIVE)
            .build();
            
        return userRepository.save(user);
    }
    
    /**
     * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·
     * 
     * @param keyword æœç´¢å…³é”®è¯ï¼Œå¯ä»¥åŒ¹é…ç”¨æˆ·åæˆ–é‚®ç®±ï¼Œä¸ºnullæ—¶æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
     * @param page é¡µç ï¼Œä»0å¼€å§‹
     * @param size æ¯é¡µå¤§å°ï¼Œå¿…é¡»å¤§äº0ä¸”ä¸è¶…è¿‡100
     * @return ç”¨æˆ·åˆ—è¡¨ï¼ŒæŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—
     * @throws IllegalArgumentException å½“åˆ†é¡µå‚æ•°ä¸åˆæ³•æ—¶
     */
    public List<User> findUsers(String keyword, int page, int size) {
        validatePagination(page, size);
        return userRepository.findByKeyword(keyword, page, size);
    }
    
    /**
     * åˆ é™¤ç”¨æˆ·
     * 
     * @param id ç”¨æˆ·IDï¼Œä¸èƒ½ä¸ºnull
     * @throws UserNotFoundException å½“ç”¨æˆ·ä¸å­˜åœ¨æ—¶
     * @throws IllegalStateException å½“ç”¨æˆ·æœ‰å…³è”æ•°æ®æ— æ³•åˆ é™¤æ—¶
     */
    public void deleteUser(Long id) throws UserNotFoundException {
        User user = userRepository.findById(id)
            .orElseThrow(() -> new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨: " + id));
            
        checkUserCanBeDeleted(user);
        userRepository.delete(user);
    }
}
```

### 4.20.1.2 å¤æ‚é€»è¾‘æ³¨é‡Šæ£€æŸ¥ ğŸŸ¡

**1. æ£€æµ‹ç›®æ ‡**

a. å¤æ‚ç®—æ³•å’Œä¸šåŠ¡é€»è¾‘æœ‰è¯¦ç»†æ³¨é‡Šè¯´æ˜
b. å…³é”®å†³ç­–ç‚¹å’Œåˆ†æ”¯é€»è¾‘æœ‰æ³¨é‡Šè§£é‡Š
c. æ€§èƒ½æ•æ„Ÿä»£ç æœ‰ä¼˜åŒ–è¯´æ˜æ³¨é‡Š

**2. æ£€æµ‹æ–¹æ³•**

1. ä»£ç å¤æ‚åº¦åˆ†æå·¥å…·ï¼ˆå¦‚åœˆå¤æ‚åº¦æ£€æŸ¥ï¼‰
2. äººå·¥ä»£ç å®¡æŸ¥
3. é™æ€åˆ†æå·¥å…·æ£€æµ‹ç¼ºå°‘æ³¨é‡Šçš„å¤æ‚æ–¹æ³•
4. AIè¾…åŠ©æ£€æµ‹å¤æ‚é€»è¾‘å—

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ å¤æ‚é€»è¾‘ç¼ºå°‘æ³¨é‡Š
public class OrderProcessor {
    
    public BigDecimal calculateDiscount(Order order, Customer customer) {
        BigDecimal discount = BigDecimal.ZERO;
        
        if (order.getAmount().compareTo(new BigDecimal("1000")) > 0) {
            if (customer.getLevel() == CustomerLevel.VIP) {
                if (customer.getYearlyPurchase().compareTo(new BigDecimal("10000")) > 0) {
                    discount = order.getAmount().multiply(new BigDecimal("0.15"));
                } else {
                    discount = order.getAmount().multiply(new BigDecimal("0.10"));
                }
            } else if (customer.getLevel() == CustomerLevel.GOLD) {
                discount = order.getAmount().multiply(new BigDecimal("0.08"));
            } else {
                discount = order.getAmount().multiply(new BigDecimal("0.05"));
            }
        } else if (order.getAmount().compareTo(new BigDecimal("500")) > 0) {
            discount = order.getAmount().multiply(new BigDecimal("0.03"));
        }
        
        return discount;
    }
    
    public void processPayment(Order order) {
        for (int i = 0; i < 3; i++) {
            try {
                paymentGateway.charge(order.getPaymentInfo(), order.getAmount());
                order.setStatus(OrderStatus.PAID);
                break;
            } catch (PaymentException e) {
                if (i == 2) {
                    order.setStatus(OrderStatus.PAYMENT_FAILED);
                    throw new OrderProcessingException("æ”¯ä»˜å¤±è´¥", e);
                }
                try {
                    Thread.sleep(1000 * (i + 1));
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new OrderProcessingException("æ”¯ä»˜ä¸­æ–­", ie);
                }
            }
        }
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šå¤æ‚é€»è¾‘æœ‰è¯¦ç»†æ³¨é‡Š
public class OrderProcessor {
    
    /**
     * è®¡ç®—è®¢å•æŠ˜æ‰£
     * 
     * æŠ˜æ‰£è®¡ç®—è§„åˆ™ï¼š
     * 1. è®¢å•é‡‘é¢ >= 1000å…ƒï¼š
     *    - VIPå®¢æˆ·ï¼šå¹´æ¶ˆè´¹ >= 10000å…ƒäº«å—15%æŠ˜æ‰£ï¼Œå¦åˆ™10%æŠ˜æ‰£
     *    - é‡‘ç‰Œå®¢æˆ·ï¼šäº«å—8%æŠ˜æ‰£
     *    - æ™®é€šå®¢æˆ·ï¼šäº«å—5%æŠ˜æ‰£
     * 2. è®¢å•é‡‘é¢ >= 500å…ƒä¸” < 1000å…ƒï¼šäº«å—3%æŠ˜æ‰£
     * 3. è®¢å•é‡‘é¢ < 500å…ƒï¼šæ— æŠ˜æ‰£
     */
    public BigDecimal calculateDiscount(Order order, Customer customer) {
        BigDecimal discount = BigDecimal.ZERO;
        BigDecimal orderAmount = order.getAmount();
        
        // å¤§é¢è®¢å•æŠ˜æ‰£ç­–ç•¥ï¼ˆ>=1000å…ƒï¼‰
        if (orderAmount.compareTo(new BigDecimal("1000")) >= 0) {
            discount = calculateLargeOrderDiscount(orderAmount, customer);
        } 
        // ä¸­ç­‰è®¢å•æŠ˜æ‰£ç­–ç•¥ï¼ˆ>=500å…ƒä¸”<1000å…ƒï¼‰
        else if (orderAmount.compareTo(new BigDecimal("500")) >= 0) {
            // ä¸­ç­‰è®¢å•ç»Ÿä¸€3%æŠ˜æ‰£
            discount = orderAmount.multiply(new BigDecimal("0.03"));
        }
        // å°é¢è®¢å•æ— æŠ˜æ‰£ï¼ˆ<500å…ƒï¼‰
        
        return discount;
    }
    
    /**
     * è®¡ç®—å¤§é¢è®¢å•æŠ˜æ‰£ï¼ˆè®¢å•é‡‘é¢>=1000å…ƒï¼‰
     * æ ¹æ®å®¢æˆ·ç­‰çº§å’Œå¹´æ¶ˆè´¹é‡‘é¢ç¡®å®šæŠ˜æ‰£æ¯”ä¾‹
     */
    private BigDecimal calculateLargeOrderDiscount(BigDecimal orderAmount, Customer customer) {
        BigDecimal discountRate;
        
        switch (customer.getLevel()) {
            case VIP:
                // VIPå®¢æˆ·æ ¹æ®å¹´æ¶ˆè´¹é‡‘é¢äº«å—ä¸åŒæŠ˜æ‰£
                boolean isHighValueCustomer = customer.getYearlyPurchase()
                    .compareTo(new BigDecimal("10000")) >= 0;
                discountRate = isHighValueCustomer ? 
                    new BigDecimal("0.15") : new BigDecimal("0.10");
                break;
            case GOLD:
                discountRate = new BigDecimal("0.08");
                break;
            default:
                discountRate = new BigDecimal("0.05");
                break;
        }
        
        return orderAmount.multiply(discountRate);
    }
    
    /**
     * å¤„ç†æ”¯ä»˜ï¼Œä½¿ç”¨é‡è¯•æœºåˆ¶æé«˜æˆåŠŸç‡
     * 
     * é‡è¯•ç­–ç•¥ï¼š
     * - æœ€å¤šé‡è¯•3æ¬¡
     * - æ¯æ¬¡é‡è¯•é—´éš”é€’å¢ï¼š1ç§’ã€2ç§’ã€3ç§’
     * - ç¬¬3æ¬¡å¤±è´¥åæŠ›å‡ºå¼‚å¸¸
     */
    public void processPayment(Order order) {
        final int maxRetries = 3;
        
        for (int attempt = 1; attempt <= maxRetries; attempt++) {
            try {
                // å°è¯•æ”¯ä»˜
                paymentGateway.charge(order.getPaymentInfo(), order.getAmount());
                order.setStatus(OrderStatus.PAID);
                return; // æ”¯ä»˜æˆåŠŸï¼Œé€€å‡ºé‡è¯•å¾ªç¯
                
            } catch (PaymentException e) {
                // æœ€åä¸€æ¬¡å°è¯•å¤±è´¥ï¼Œæ ‡è®°è®¢å•çŠ¶æ€å¹¶æŠ›å‡ºå¼‚å¸¸
                if (attempt == maxRetries) {
                    order.setStatus(OrderStatus.PAYMENT_FAILED);
                    throw new OrderProcessingException(
                        String.format("æ”¯ä»˜å¤±è´¥ï¼Œå·²é‡è¯•%dæ¬¡", maxRetries), e);
                }
                
                // ç­‰å¾…åé‡è¯•ï¼Œç­‰å¾…æ—¶é—´é€’å¢
                try {
                    long waitTime = 1000L * attempt; // 1ç§’ã€2ç§’ã€3ç§’
                    Thread.sleep(waitTime);
                } catch (InterruptedException ie) {
                    // æ¢å¤ä¸­æ–­çŠ¶æ€å¹¶æŠ›å‡ºå¼‚å¸¸
                    Thread.currentThread().interrupt();
                    throw new OrderProcessingException("æ”¯ä»˜è¿‡ç¨‹è¢«ä¸­æ–­", ie);
                }
            }
        }
    }
}
```

### 4.20.1.3 TODOå’ŒFIXMEæ ‡è®°æ£€æŸ¥ ğŸŸ¢

**1. æ£€æµ‹ç›®æ ‡**

a. TODOæ ‡è®°æœ‰æ˜ç¡®çš„ä»»åŠ¡æè¿°å’Œè´Ÿè´£äºº
b. FIXMEæ ‡è®°æœ‰é—®é¢˜æè¿°å’Œä¿®å¤è®¡åˆ’
c. ä¸´æ—¶ä»£ç æ ‡è®°æœ‰æ¸…ç†æ—¶é—´è®¡åˆ’

**2. æ£€æµ‹æ–¹æ³•**

1. é™æ€ä»£ç åˆ†æå·¥å…·æ‰«æTODO/FIXMEæ ‡è®°
2. IDEæ’ä»¶æ£€æŸ¥æ ‡è®°æ ¼å¼å’Œå†…å®¹
3. ä»£ç å®¡æŸ¥æ£€æŸ¥æ ‡è®°çš„åˆç†æ€§
4. å®šæœŸæ¸…ç†æ£€æŸ¥è¿‡æœŸæ ‡è®°

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ æ ‡è®°ä¿¡æ¯ä¸å®Œæ•´æˆ–ä¸è§„èŒƒ
public class UserService {
    
    public User createUser(String name, String email) {
        // TODO éªŒè¯é‚®ç®±
        // æ²¡æœ‰è´Ÿè´£äººå’Œæ—¶é—´è®¡åˆ’
        
        // FIXME è¿™é‡Œæœ‰bug
        // æ²¡æœ‰å…·ä½“æè¿°é—®é¢˜å’Œä¿®å¤è®¡åˆ’
        
        User user = new User(name, email);
        
        // ä¸´æ—¶ä»£ç ï¼Œæ²¡æœ‰æ ‡è®°
        if (true) {
            System.out.println("Debug: " + user);
        }
        
        return userRepository.save(user);
    }
    
    public void updateUser(User user) {
        // TODO
        // ç©ºçš„TODOæ ‡è®°
        
        // HACK: ä¸´æ—¶è§£å†³æ–¹æ¡ˆ
        // ä½¿ç”¨éæ ‡å‡†æ ‡è®°
        
        userRepository.save(user);
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šæ ‡è®°ä¿¡æ¯å®Œæ•´è§„èŒƒ
public class UserService {
    
    public User createUser(String name, String email) {
        // TODO: æ·»åŠ é‚®ç®±æ ¼å¼éªŒè¯å’Œå”¯ä¸€æ€§æ£€æŸ¥
        // è´Ÿè´£äºº: å¼ ä¸‰ (zhangsan@company.com)
        // è®¡åˆ’å®Œæˆæ—¶é—´: 2024-02-15
        // ä¼˜å…ˆçº§: é«˜
        validateBasicInput(name, email);
        
        // FIXME: å¹¶å‘åˆ›å»ºç”¨æˆ·æ—¶å¯èƒ½å‡ºç°é‚®ç®±é‡å¤é—®é¢˜
        // é—®é¢˜æè¿°: åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸¤ä¸ªè¯·æ±‚åŒæ—¶æ£€æŸ¥é‚®ç®±å”¯ä¸€æ€§å¯èƒ½éƒ½é€šè¿‡
        // ä¿®å¤è®¡åˆ’: åœ¨æ•°æ®åº“å±‚é¢æ·»åŠ å”¯ä¸€çº¦æŸï¼Œå¹¶å¤„ç†çº¦æŸè¿åå¼‚å¸¸
        // è´Ÿè´£äºº: æå›› (lisi@company.com)
        // è®¡åˆ’ä¿®å¤æ—¶é—´: 2024-02-10
        checkEmailUniqueness(email);
        
        User user = User.builder()
            .name(name)
            .email(email)
            .createdAt(Instant.now())
            .build();
        
        return userRepository.save(user);
    }
    
    public void updateUser(User user) {
        // TODO: å®ç°ç”¨æˆ·ä¿¡æ¯å˜æ›´å†å²è®°å½•åŠŸèƒ½
        // éœ€æ±‚: è®°å½•ç”¨æˆ·ä¿¡æ¯çš„æ¯æ¬¡å˜æ›´ï¼ŒåŒ…æ‹¬å˜æ›´æ—¶é—´ã€å˜æ›´äººã€å˜æ›´å†…å®¹
        // è´Ÿè´£äºº: ç‹äº” (wangwu@company.com)
        // é¢„è®¡å·¥ä½œé‡: 3äººå¤©
        // è®¡åˆ’å¼€å§‹æ—¶é—´: 2024-02-20
        
        validateUserForUpdate(user);
        
        // FIXME: æ›´æ–°æ“ä½œç¼ºå°‘ä¹è§‚é”æ§åˆ¶
        // é—®é¢˜: å¯èƒ½å‡ºç°å¹¶å‘æ›´æ–°å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
        // è§£å†³æ–¹æ¡ˆ: æ·»åŠ versionå­—æ®µå®ç°ä¹è§‚é”
        // å½±å“èŒƒå›´: Userå®ä½“ç±»ã€UserRepositoryã€ç›¸å…³ä¸šåŠ¡é€»è¾‘
        // è´Ÿè´£äºº: èµµå…­ (zhaoliu@company.com)
        // è®¡åˆ’ä¿®å¤æ—¶é—´: 2024-02-12
        userRepository.save(user);
    }
    
    private void debugUserCreation(User user) {
        // TEMP: ä¸´æ—¶è°ƒè¯•ä»£ç ï¼Œç”¨äºæ’æŸ¥ç”¨æˆ·åˆ›å»ºé—®é¢˜
        // æ·»åŠ æ—¶é—´: 2024-01-15
        // æ¸…ç†è®¡åˆ’: é—®é¢˜è§£å†³åç«‹å³åˆ é™¤ï¼Œæœ€æ™š2024-02-01
        // è´Ÿè´£äºº: å¼€å‘å›¢é˜Ÿ
        if (isDebugMode()) {
            logger.debug("åˆ›å»ºç”¨æˆ·: {}, æ—¶é—´: {}", user, Instant.now());
        }
    }
}
```

## 4.20.2 APIæ–‡æ¡£å®Œæ•´æ€§

### 4.20.2.1 æ¥å£æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥ ğŸ”´

**1. æ£€æµ‹ç›®æ ‡**

a. æ‰€æœ‰å…¬å¼€APIéƒ½æœ‰å®Œæ•´çš„æ¥å£æ–‡æ¡£
b. æ–‡æ¡£åŒ…å«æ¥å£åŠŸèƒ½ã€ç”¨é€”å’Œä½¿ç”¨åœºæ™¯è¯´æ˜
c. æ–‡æ¡£ä¸å®é™…æ¥å£å®ç°ä¿æŒåŒæ­¥

**2. æ£€æµ‹æ–¹æ³•**

1. Swagger/OpenAPIæ–‡æ¡£ç”Ÿæˆå’ŒéªŒè¯
2. æ¥å£æ–‡æ¡£è¦†ç›–ç‡æ£€æŸ¥
3. æ–‡æ¡£ä¸ä»£ç ä¸€è‡´æ€§éªŒè¯
4. APIæ–‡æ¡£å®¡æŸ¥

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ ç¼ºå°‘æ¥å£æ–‡æ¡£æˆ–æ–‡æ¡£ä¸å®Œæ•´
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // æ²¡æœ‰ä»»ä½•æ–‡æ¡£æ³¨è§£
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        return ResponseEntity.ok(user);
    }
    
    // æ–‡æ¡£ä¿¡æ¯ä¸å®Œæ•´
    @PostMapping
    @ApiOperation("åˆ›å»ºç”¨æˆ·")
    public ResponseEntity<User> createUser(@RequestBody User user) {
        // ç¼ºå°‘å‚æ•°è¯´æ˜ã€è¿”å›å€¼è¯´æ˜ã€é”™è¯¯ç è¯´æ˜
        User created = userService.create(user);
        return ResponseEntity.ok(created);
    }
    
    // æ–‡æ¡£ä¸å®é™…å®ç°ä¸ä¸€è‡´
    @PutMapping("/{id}")
    @ApiOperation(value = "æ›´æ–°ç”¨æˆ·", notes = "æ›´æ–°æŒ‡å®šIDçš„ç”¨æˆ·ä¿¡æ¯")
    @ApiResponse(code = 200, message = "æ›´æ–°æˆåŠŸ")
    public ResponseEntity<User> updateUser(
            @PathVariable Long id, 
            @RequestBody User user) {
        // å®é™…å¯èƒ½è¿”å›404ï¼Œä½†æ–‡æ¡£ä¸­æ²¡æœ‰è¯´æ˜
        User updated = userService.update(id, user);
        return ResponseEntity.ok(updated);
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„æ¥å£æ–‡æ¡£
@RestController
@RequestMapping("/api/users")
@Api(tags = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·ç›¸å…³çš„CRUDæ“ä½œæ¥å£")
public class UserController {
    
    @GetMapping("/{id}")
    @ApiOperation(
        value = "æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·",
        notes = "æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€"
    )
    @ApiParam(name = "id", value = "ç”¨æˆ·ID", required = true, example = "1")
    @ApiResponses({
        @ApiResponse(code = 200, message = "æŸ¥è¯¢æˆåŠŸ", response = User.class),
        @ApiResponse(code = 404, message = "ç”¨æˆ·ä¸å­˜åœ¨", response = ErrorResponse.class),
        @ApiResponse(code = 500, message = "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯", response = ErrorResponse.class)
    })
    public ResponseEntity<User> getUser(
            @PathVariable 
            @ApiParam(value = "ç”¨æˆ·IDï¼Œå¿…é¡»ä¸ºæ­£æ•´æ•°", required = true, example = "1")
            Long id) {
        
        User user = userService.findById(id);
        return ResponseEntity.ok(user);
    }
    
    @PostMapping
    @ApiOperation(
        value = "åˆ›å»ºæ–°ç”¨æˆ·",
        notes = "åˆ›å»ºæ–°ç”¨æˆ·ï¼Œé‚®ç®±å¿…é¡»å”¯ä¸€ã€‚åˆ›å»ºæˆåŠŸåè¿”å›åŒ…å«IDçš„ç”¨æˆ·ä¿¡æ¯ã€‚"
    )
    @ApiResponses({
        @ApiResponse(code = 201, message = "åˆ›å»ºæˆåŠŸ", response = User.class),
        @ApiResponse(code = 400, message = "è¯·æ±‚å‚æ•°é”™è¯¯", response = ErrorResponse.class),
        @ApiResponse(code = 409, message = "é‚®ç®±å·²å­˜åœ¨", response = ErrorResponse.class),
        @ApiResponse(code = 500, message = "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯", response = ErrorResponse.class)
    })
    public ResponseEntity<User> createUser(
            @RequestBody 
            @ApiParam(value = "ç”¨æˆ·ä¿¡æ¯", required = true)
            @Valid CreateUserRequest request) {
        
        User created = userService.create(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }
    
    @PutMapping("/{id}")
    @ApiOperation(
        value = "æ›´æ–°ç”¨æˆ·ä¿¡æ¯",
        notes = "æ›´æ–°æŒ‡å®šIDçš„ç”¨æˆ·ä¿¡æ¯ã€‚åªæ›´æ–°æä¾›çš„å­—æ®µï¼Œæœªæä¾›çš„å­—æ®µä¿æŒä¸å˜ã€‚"
    )
    @ApiResponses({
        @ApiResponse(code = 200, message = "æ›´æ–°æˆåŠŸ", response = User.class),
        @ApiResponse(code = 400, message = "è¯·æ±‚å‚æ•°é”™è¯¯", response = ErrorResponse.class),
        @ApiResponse(code = 404, message = "ç”¨æˆ·ä¸å­˜åœ¨", response = ErrorResponse.class),
        @ApiResponse(code = 409, message = "é‚®ç®±å†²çª", response = ErrorResponse.class),
        @ApiResponse(code = 500, message = "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯", response = ErrorResponse.class)
    })
    public ResponseEntity<User> updateUser(
            @PathVariable 
            @ApiParam(value = "ç”¨æˆ·ID", required = true, example = "1")
            Long id,
            @RequestBody 
            @ApiParam(value = "æ›´æ–°çš„ç”¨æˆ·ä¿¡æ¯", required = true)
            @Valid UpdateUserRequest request) {
        
        User updated = userService.update(id, request);
        return ResponseEntity.ok(updated);
    }
}
```

### 4.20.2.2 å‚æ•°è¯´æ˜å®Œæ•´æ€§æ£€æŸ¥ ğŸ”´

**1. æ£€æµ‹ç›®æ ‡**

a. æ‰€æœ‰APIå‚æ•°éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜æ–‡æ¡£
b. å‚æ•°ç±»å‹ã€æ ¼å¼ã€çº¦æŸæ¡ä»¶æ¸…æ™°æ˜ç¡®
c. å¿…å¡«å’Œå¯é€‰å‚æ•°æ ‡è¯†æ¸…æ¥š

**2. æ£€æµ‹æ–¹æ³•**

1. APIæ–‡æ¡£ç”Ÿæˆå·¥å…·æ£€æŸ¥å‚æ•°æ–‡æ¡£
2. å‚æ•°éªŒè¯æ³¨è§£ä¸æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥
3. å‚æ•°ç¤ºä¾‹å€¼çš„æœ‰æ•ˆæ€§éªŒè¯
4. æ–‡æ¡£å®¡æŸ¥

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ å‚æ•°è¯´æ˜ä¸å®Œæ•´æˆ–ä¸å‡†ç¡®
@RestController
public class OrderController {
    
    // å‚æ•°æ²¡æœ‰ä»»ä½•è¯´æ˜
    @GetMapping("/orders")
    public PageResult<Order> getOrders(
            @RequestParam String status,
            @RequestParam int page,
            @RequestParam int size) {
        return orderService.findOrders(status, page, size);
    }
    
    // å‚æ•°è¯´æ˜è¿‡äºç®€å•
    @PostMapping("/orders")
    public Order createOrder(
            @RequestBody 
            @ApiParam("è®¢å•")
            Order order) {
        return orderService.create(order);
    }
    
    // å‚æ•°çº¦æŸä¸æ–‡æ¡£ä¸ä¸€è‡´
    @GetMapping("/orders/search")
    public List<Order> searchOrders(
            @RequestParam 
            @ApiParam(value = "å…³é”®è¯", required = false)
            @NotBlank // å®é™…æ˜¯å¿…å¡«ï¼Œä½†æ–‡æ¡£è¯´å¯é€‰
            String keyword,
            
            @RequestParam 
            @ApiParam(value = "é¡µç ", example = "1")
            @Min(0) // å®é™…ä»0å¼€å§‹ï¼Œä½†ç¤ºä¾‹æ˜¯1
            int page) {
        return orderService.search(keyword, page);
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šå‚æ•°è¯´æ˜å®Œæ•´å‡†ç¡®
@RestController
@RequestMapping("/api/orders")
public class OrderController {
    
    @GetMapping
    @ApiOperation(value = "åˆ†é¡µæŸ¥è¯¢è®¢å•", notes = "æ ¹æ®çŠ¶æ€åˆ†é¡µæŸ¥è¯¢è®¢å•åˆ—è¡¨")
    public PageResult<Order> getOrders(
            @RequestParam 
            @ApiParam(
                value = "è®¢å•çŠ¶æ€", 
                required = true,
                allowableValues = "PENDING,PAID,SHIPPED,DELIVERED,CANCELLED",
                example = "PENDING"
            )
            @NotBlank(message = "è®¢å•çŠ¶æ€ä¸èƒ½ä¸ºç©º")
            String status,
            
            @RequestParam 
            @ApiParam(
                value = "é¡µç ï¼Œä»0å¼€å§‹", 
                required = true,
                example = "0"
            )
            @Min(value = 0, message = "é¡µç ä¸èƒ½å°äº0")
            int page,
            
            @RequestParam 
            @ApiParam(
                value = "æ¯é¡µå¤§å°ï¼ŒèŒƒå›´1-100", 
                required = true,
                example = "20"
            )
            @Min(value = 1, message = "æ¯é¡µå¤§å°ä¸èƒ½å°äº1")
            @Max(value = 100, message = "æ¯é¡µå¤§å°ä¸èƒ½è¶…è¿‡100")
            int size) {
        
        return orderService.findOrders(status, page, size);
    }
    
    @PostMapping
    @ApiOperation(value = "åˆ›å»ºè®¢å•", notes = "åˆ›å»ºæ–°è®¢å•ï¼Œéœ€è¦æä¾›å®Œæ•´çš„è®¢å•ä¿¡æ¯")
    public Order createOrder(
            @RequestBody 
            @ApiParam(
                value = "è®¢å•ä¿¡æ¯ï¼ŒåŒ…å«å•†å“åˆ—è¡¨ã€æ”¶è´§åœ°å€ã€æ”¯ä»˜æ–¹å¼ç­‰",
                required = true
            )
            @Valid CreateOrderRequest request) {
        
        return orderService.create(request);
    }
    
    @GetMapping("/search")
    @ApiOperation(value = "æœç´¢è®¢å•", notes = "æ ¹æ®å…³é”®è¯æœç´¢è®¢å•ï¼Œæ”¯æŒè®¢å•å·ã€å•†å“åç§°ç­‰")
    public List<Order> searchOrders(
            @RequestParam 
            @ApiParam(
                value = "æœç´¢å…³é”®è¯ï¼Œæ”¯æŒè®¢å•å·ã€å•†å“åç§°ã€ç”¨æˆ·åç­‰ï¼Œä¸èƒ½ä¸ºç©º",
                required = true,
                example = "iPhone"
            )
            @NotBlank(message = "æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©º")
            @Size(min = 2, max = 50, message = "å…³é”®è¯é•¿åº¦å¿…é¡»åœ¨2-50å­—ç¬¦ä¹‹é—´")
            String keyword,
            
            @RequestParam(defaultValue = "0")
            @ApiParam(
                value = "é¡µç ï¼Œä»0å¼€å§‹ï¼Œé»˜è®¤ä¸º0",
                required = false,
                example = "0"
            )
            @Min(value = 0, message = "é¡µç ä¸èƒ½å°äº0")
            int page,
            
            @RequestParam(defaultValue = "20")
            @ApiParam(
                value = "æ¯é¡µå¤§å°ï¼ŒèŒƒå›´1-100ï¼Œé»˜è®¤ä¸º20",
                required = false,
                example = "20"
            )
            @Min(value = 1, message = "æ¯é¡µå¤§å°ä¸èƒ½å°äº1")
            @Max(value = 100, message = "æ¯é¡µå¤§å°ä¸èƒ½è¶…è¿‡100")
            int size) {
        
        return orderService.search(keyword, page, size);
    }
}

/**
 * åˆ›å»ºè®¢å•è¯·æ±‚å¯¹è±¡
 */
@ApiModel(description = "åˆ›å»ºè®¢å•è¯·æ±‚")
public class CreateOrderRequest {
    
    @ApiModelProperty(
        value = "å•†å“åˆ—è¡¨",
        required = true,
        notes = "è‡³å°‘åŒ…å«ä¸€ä¸ªå•†å“"
    )
    @NotEmpty(message = "å•†å“åˆ—è¡¨ä¸èƒ½ä¸ºç©º")
    @Valid
    private List<OrderItem> items;
    
    @ApiModelProperty(
        value = "æ”¶è´§åœ°å€ID",
        required = true,
        example = "123"
    )
    @NotNull(message = "æ”¶è´§åœ°å€ä¸èƒ½ä¸ºç©º")
    @Positive(message = "æ”¶è´§åœ°å€IDå¿…é¡»ä¸ºæ­£æ•°")
    private Long addressId;
    
    @ApiModelProperty(
        value = "æ”¯ä»˜æ–¹å¼",
        required = true,
        allowableValues = "ALIPAY,WECHAT,CREDIT_CARD",
        example = "ALIPAY"
    )
    @NotNull(message = "æ”¯ä»˜æ–¹å¼ä¸èƒ½ä¸ºç©º")
    private PaymentMethod paymentMethod;
    
    @ApiModelProperty(
        value = "è®¢å•å¤‡æ³¨",
        required = false,
        example = "è¯·å°½å¿«å‘è´§"
    )
    @Size(max = 200, message = "å¤‡æ³¨é•¿åº¦ä¸èƒ½è¶…è¿‡200å­—ç¬¦")
    private String remark;
    
    // getters and setters...
}
```

### 4.20.2.3 ç¤ºä¾‹ä»£ç å®Œæ•´æ€§æ£€æŸ¥ ğŸŸ¡

**1. æ£€æµ‹ç›®æ ‡**

a. APIæ–‡æ¡£åŒ…å«å®Œæ•´çš„è¯·æ±‚å’Œå“åº”ç¤ºä¾‹
b. ç¤ºä¾‹ä»£ç å¯ä»¥ç›´æ¥è¿è¡Œå’Œæµ‹è¯•
c. ç¤ºä¾‹è¦†ç›–ä¸»è¦ä½¿ç”¨åœºæ™¯å’Œé”™è¯¯æƒ…å†µ

**2. æ£€æµ‹æ–¹æ³•**

1. æ–‡æ¡£ç¤ºä¾‹ä»£ç çš„è¯­æ³•æ£€æŸ¥
2. ç¤ºä¾‹ä¸å®é™…APIçš„ä¸€è‡´æ€§éªŒè¯
3. ç¤ºä¾‹ä»£ç çš„å¯æ‰§è¡Œæ€§æµ‹è¯•
4. ç¤ºä¾‹è¦†ç›–ç‡æ£€æŸ¥

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ ç¼ºå°‘ç¤ºä¾‹æˆ–ç¤ºä¾‹ä¸å®Œæ•´
@RestController
public class ProductController {
    
    // æ²¡æœ‰ä»»ä½•ç¤ºä¾‹
    @GetMapping("/products/{id}")
    @ApiOperation("è·å–å•†å“è¯¦æƒ…")
    public Product getProduct(@PathVariable Long id) {
        return productService.findById(id);
    }
    
    // ç¤ºä¾‹ä¸å®Œæ•´ï¼Œåªæœ‰æˆåŠŸæƒ…å†µ
    @PostMapping("/products")
    @ApiOperation(value = "åˆ›å»ºå•†å“", 
                 notes = "ç¤ºä¾‹ï¼šPOST /products {\"name\":\"iPhone\"}")
    public Product createProduct(@RequestBody Product product) {
        return productService.create(product);
    }
    
    // ç¤ºä¾‹æœ‰è¯­æ³•é”™è¯¯
    @PutMapping("/products/{id}")
    @ApiOperation(value = "æ›´æ–°å•†å“",
                 notes = "ç¤ºä¾‹ï¼šPUT /products/1 {name: iPhone 15}")
    // JSONæ ¼å¼é”™è¯¯ï¼Œç¼ºå°‘å¼•å·
    public Product updateProduct(@PathVariable Long id, @RequestBody Product product) {
        return productService.update(id, product);
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„ç¤ºä¾‹ä»£ç 
@RestController
@RequestMapping("/api/products")
@Api(tags = "å•†å“ç®¡ç†")
public class ProductController {
    
    @GetMapping("/{id}")
    @ApiOperation(
        value = "è·å–å•†å“è¯¦æƒ…",
        notes = "æ ¹æ®å•†å“IDè·å–å•†å“è¯¦ç»†ä¿¡æ¯\n\n" +
                "**è¯·æ±‚ç¤ºä¾‹ï¼š**\n" +
                "```\n" +
                "GET /api/products/1\n" +
                "```\n\n" +
                "**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**\n" +
                "```json\n" +
                "{\n" +
                "  \"id\": 1,\n" +
                "  \"name\": \"iPhone 15\",\n" +
                "  \"price\": 7999.00,\n" +
                "  \"category\": \"æ‰‹æœº\",\n" +
                "  \"stock\": 100,\n" +
                "  \"status\": \"ACTIVE\"\n" +
                "}\n" +
                "```\n\n" +
                "**é”™è¯¯å“åº”ç¤ºä¾‹ï¼š**\n" +
                "```json\n" +
                "{\n" +
                "  \"error\": {\n" +
                "    \"code\": \"PRODUCT_NOT_FOUND\",\n" +
                "    \"message\": \"å•†å“ä¸å­˜åœ¨\"\n" +
                "  }\n" +
                "}\n" +
                "```"
    )
    public ResponseEntity<Product> getProduct(@PathVariable Long id) {
        Product product = productService.findById(id);
        return ResponseEntity.ok(product);
    }
    
    @PostMapping
    @ApiOperation(
        value = "åˆ›å»ºå•†å“",
        notes = "åˆ›å»ºæ–°å•†å“\n\n" +
                "**è¯·æ±‚ç¤ºä¾‹ï¼š**\n" +
                "```bash\n" +
                "curl -X POST http://localhost:8080/api/products \\\n" +
                "  -H \"Content-Type: application/json\" \\\n" +
                "  -d '{\n" +
                "    \"name\": \"iPhone 15\",\n" +
                "    \"price\": 7999.00,\n" +
                "    \"categoryId\": 1,\n" +
                "    \"description\": \"æœ€æ–°æ¬¾iPhone\",\n" +
                "    \"stock\": 100\n" +
                "  }'\n" +
                "```\n\n" +
                "**æˆåŠŸå“åº”ç¤ºä¾‹ï¼ˆ201 Createdï¼‰ï¼š**\n" +
                "```json\n" +
                "{\n" +
                "  \"id\": 123,\n" +
                "  \"name\": \"iPhone 15\",\n" +
                "  \"price\": 7999.00,\n" +
                "  \"category\": \"æ‰‹æœº\",\n" +
                "  \"description\": \"æœ€æ–°æ¬¾iPhone\",\n" +
                "  \"stock\": 100,\n" +
                "  \"status\": \"ACTIVE\",\n" +
                "  \"createdAt\": \"2024-01-15T10:30:00Z\"\n" +
                "}\n" +
                "```\n\n" +
                "**é”™è¯¯å“åº”ç¤ºä¾‹ï¼ˆ400 Bad Requestï¼‰ï¼š**\n" +
                "```json\n" +
                "{\n" +
                "  \"error\": {\n" +
                "    \"code\": \"VALIDATION_ERROR\",\n" +
                "    \"message\": \"å‚æ•°éªŒè¯å¤±è´¥\",\n" +
                "    \"details\": [\n" +
                "      {\n" +
                "        \"field\": \"name\",\n" +
                "        \"message\": \"å•†å“åç§°ä¸èƒ½ä¸ºç©º\"\n" +
                "      },\n" +
                "      {\n" +
                "        \"field\": \"price\",\n" +
                "        \"message\": \"ä»·æ ¼å¿…é¡»å¤§äº0\"\n" +
                "      }\n" +
                "    ]\n" +
                "  }\n" +
                "}\n" +
                "```"
    )
    public ResponseEntity<Product> createProduct(
            @RequestBody @Valid CreateProductRequest request) {
        Product created = productService.create(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }
    
    @GetMapping
    @ApiOperation(
        value = "åˆ†é¡µæŸ¥è¯¢å•†å“",
        notes = "åˆ†é¡µæŸ¥è¯¢å•†å“åˆ—è¡¨ï¼Œæ”¯æŒæŒ‰åˆ†ç±»å’ŒçŠ¶æ€ç­›é€‰\n\n" +
                "**è¯·æ±‚ç¤ºä¾‹ï¼š**\n" +
                "```bash\n" +
                "# æŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œæ¯é¡µ20æ¡\n" +
                "GET /api/products?page=0&size=20\n" +
                "\n" +
                "# æŒ‰åˆ†ç±»ç­›é€‰\n" +
                "GET /api/products?categoryId=1&page=0&size=20\n" +
                "\n" +
                "# æŒ‰çŠ¶æ€ç­›é€‰\n" +
                "GET /api/products?status=ACTIVE&page=0&size=20\n" +
                "\n" +
                "# ç»„åˆç­›é€‰\n" +
                "GET /api/products?categoryId=1&status=ACTIVE&page=0&size=20\n" +
                "```\n\n" +
                "**å“åº”ç¤ºä¾‹ï¼š**\n" +
                "```json\n" +
                "{\n" +
                "  \"content\": [\n" +
                "    {\n" +
                "      \"id\": 1,\n" +
                "      \"name\": \"iPhone 15\",\n" +
                "      \"price\": 7999.00,\n" +
                "      \"category\": \"æ‰‹æœº\",\n" +
                "      \"stock\": 100,\n" +
                "      \"status\": \"ACTIVE\"\n" +
                "    }\n" +
                "  ],\n" +
                "  \"page\": {\n" +
                "    \"number\": 0,\n" +
                "    \"size\": 20,\n" +
                "    \"totalElements\": 1,\n" +
                "    \"totalPages\": 1\n" +
                "  }\n" +
                "}\n" +
                "```"
    )
    public PageResult<Product> getProducts(
            @RequestParam(required = false) Long categoryId,
            @RequestParam(required = false) ProductStatus status,
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "20") int size) {
        return productService.findProducts(categoryId, status, page, size);
    }
}
```

## 4.20.3 å˜æ›´æ–‡æ¡£å®Œæ•´æ€§

### 4.20.3.1 å˜æ›´æ—¥å¿—è®°å½•æ£€æŸ¥ ğŸŸ¡

**1. æ£€æµ‹ç›®æ ‡**

a. æ¯æ¬¡ä»£ç å˜æ›´éƒ½æœ‰è¯¦ç»†çš„å˜æ›´æ—¥å¿—è®°å½•
b. å˜æ›´æ—¥å¿—åŒ…å«å˜æ›´åŸå› ã€å½±å“èŒƒå›´å’Œé£é™©è¯„ä¼°
c. å˜æ›´è®°å½•æ ¼å¼ç»Ÿä¸€ï¼Œä¾¿äºè¿½è¸ªå’Œå›æº¯

**2. æ£€æµ‹æ–¹æ³•**

1. Gitæäº¤ä¿¡æ¯è§„èŒƒæ€§æ£€æŸ¥
2. å˜æ›´æ—¥å¿—æ–‡ä»¶å®Œæ•´æ€§éªŒè¯
3. å˜æ›´è®°å½•ä¸å®é™…ä»£ç ä¿®æ”¹çš„ä¸€è‡´æ€§æ£€æŸ¥
4. å˜æ›´å®¡æ‰¹æµç¨‹åˆè§„æ€§æ£€æŸ¥

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ å˜æ›´æ—¥å¿—è®°å½•ä¸å®Œæ•´æˆ–ä¸è§„èŒƒ

// Gitæäº¤ä¿¡æ¯è¿‡äºç®€å•
// git commit -m "fix bug"
// git commit -m "update"
// git commit -m "ä¿®æ”¹ä»£ç "

// CHANGELOG.md ç¼ºå°‘è¯¦ç»†ä¿¡æ¯
## [1.2.0] - 2024-01-15
### Changed
- ä¿®æ”¹äº†ç”¨æˆ·æœåŠ¡
- æ›´æ–°äº†è®¢å•å¤„ç†é€»è¾‘

// ä»£ç ä¸­ç¼ºå°‘å˜æ›´è¯´æ˜æ³¨é‡Š
public class UserService {
    
    public User createUser(String name, String email) {
        // ç›´æ¥ä¿®æ”¹äº†ä¸šåŠ¡é€»è¾‘ï¼Œæ²¡æœ‰è¯´æ˜åŸå› 
        if (email.contains("@test.com")) {
            throw new IllegalArgumentException("æµ‹è¯•é‚®ç®±ä¸å…è®¸æ³¨å†Œ");
        }
        
        // ä¿®æ”¹äº†éªŒè¯é€»è¾‘ï¼Œæ²¡æœ‰è®°å½•å˜æ›´åŸå› 
        validateUserInput(name, email);
        return userRepository.save(new User(name, email));
    }
}

// æ•°æ®åº“å˜æ›´ç¼ºå°‘è¯´æ˜
-- migration_001.sql
ALTER TABLE users ADD COLUMN phone VARCHAR(20);
UPDATE users SET status = 'ACTIVE' WHERE status IS NULL;
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„å˜æ›´æ—¥å¿—è®°å½•

// Gitæäº¤ä¿¡æ¯è§„èŒƒ
// git commit -m "feat(user): æ·»åŠ ç”¨æˆ·æ‰‹æœºå·éªŒè¯åŠŸèƒ½
// 
// - æ–°å¢æ‰‹æœºå·å­—æ®µå’ŒéªŒè¯é€»è¾‘
// - ä¿®æ”¹ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼Œæ”¯æŒæ‰‹æœºå·éªŒè¯
// - æ·»åŠ æ‰‹æœºå·æ ¼å¼éªŒè¯å’Œå”¯ä¸€æ€§æ£€æŸ¥
// 
// å½±å“èŒƒå›´ï¼šç”¨æˆ·æ³¨å†Œã€ç”¨æˆ·ä¿¡æ¯æ›´æ–°
// æµ‹è¯•ï¼šå·²é€šè¿‡å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
// æ–‡æ¡£ï¼šå·²æ›´æ–°APIæ–‡æ¡£å’Œç”¨æˆ·æ‰‹å†Œ
// 
// Closes #123"

// CHANGELOG.md è¯¦ç»†è®°å½•
## [1.2.0] - 2024-01-15

### Added
- **ç”¨æˆ·ç®¡ç†**: æ–°å¢ç”¨æˆ·æ‰‹æœºå·éªŒè¯åŠŸèƒ½ (#123)
  - æ”¯æŒæ‰‹æœºå·æ³¨å†Œå’Œç™»å½•
  - æ·»åŠ æ‰‹æœºå·æ ¼å¼éªŒè¯ï¼ˆæ”¯æŒä¸­å›½å¤§é™†æ‰‹æœºå·ï¼‰
  - å®ç°æ‰‹æœºå·å”¯ä¸€æ€§æ£€æŸ¥
  - æ–°å¢æ‰‹æœºéªŒè¯ç å‘é€å’ŒéªŒè¯æ¥å£

### Changed
- **ç”¨æˆ·æœåŠ¡**: ä¼˜åŒ–ç”¨æˆ·æ³¨å†Œæµç¨‹ (#124)
  - é‡æ„ç”¨æˆ·è¾“å…¥éªŒè¯é€»è¾‘ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§
  - ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
  - æ”¹è¿›ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒé‚®ç®±å’Œæ‰‹æœºå·åŒé‡éªŒè¯

### Fixed
- **è®¢å•å¤„ç†**: ä¿®å¤å¹¶å‘åˆ›å»ºè®¢å•æ—¶çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ (#125)
  - æ·»åŠ ä¹è§‚é”æ§åˆ¶ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹å†²çª
  - ä¼˜åŒ–åº“å­˜æ‰£å‡é€»è¾‘ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
  - ä¿®å¤è®¢å•çŠ¶æ€æ›´æ–°æ—¶çš„ç«æ€æ¡ä»¶

### Security
- **è®¤è¯æˆæƒ**: åŠ å¼ºç”¨æˆ·å¯†ç å®‰å…¨ç­–ç•¥ (#126)
  - æé«˜å¯†ç å¤æ‚åº¦è¦æ±‚
  - å®ç°å¯†ç å†å²è®°å½•ï¼Œé˜²æ­¢é‡å¤ä½¿ç”¨
  - æ·»åŠ è´¦æˆ·é”å®šæœºåˆ¶ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£

### Breaking Changes
- **APIå˜æ›´**: ç”¨æˆ·æ³¨å†Œæ¥å£å‚æ•°è°ƒæ•´
  - åŸæ¥å£ï¼š`POST /api/users {"name": "...", "email": "..."}`
  - æ–°æ¥å£ï¼š`POST /api/users {"name": "...", "email": "...", "phone": "..."}`
  - è¿ç§»æŒ‡å—ï¼šå‚è§ docs/migration/v1.2.0.md

// ä»£ç ä¸­çš„å˜æ›´è¯´æ˜æ³¨é‡Š
public class UserService {
    
    /**
     * åˆ›å»ºæ–°ç”¨æˆ·
     * 
     * å˜æ›´å†å²ï¼š
     * - v1.1.0: åˆå§‹å®ç°ï¼Œä»…æ”¯æŒé‚®ç®±æ³¨å†Œ
     * - v1.2.0: æ·»åŠ æ‰‹æœºå·æ”¯æŒï¼Œå¢å¼ºéªŒè¯é€»è¾‘
     *   å˜æ›´åŸå› ï¼šä¸šåŠ¡éœ€æ±‚ï¼Œæ”¯æŒæ‰‹æœºå·æ³¨å†Œæé«˜ç”¨æˆ·ä½“éªŒ
     *   å½±å“èŒƒå›´ï¼šç”¨æˆ·æ³¨å†Œæµç¨‹ã€éªŒè¯é€»è¾‘ã€æ•°æ®åº“ç»“æ„
     *   é£é™©è¯„ä¼°ï¼šä½é£é™©ï¼Œå‘åå…¼å®¹
     */
    public User createUser(CreateUserRequest request) {
        // v1.2.0 æ–°å¢ï¼šæ‰‹æœºå·éªŒè¯é€»è¾‘
        // å˜æ›´åŸå› ï¼šæ”¯æŒæ‰‹æœºå·æ³¨å†Œï¼Œæé«˜ç”¨æˆ·æ³¨å†ŒæˆåŠŸç‡
        if (request.getPhone() != null) {
            validatePhoneNumber(request.getPhone());
            checkPhoneUniqueness(request.getPhone());
        }
        
        // v1.2.0 é‡æ„ï¼šç»Ÿä¸€éªŒè¯é€»è¾‘
        // å˜æ›´åŸå› ï¼šåŸæœ‰éªŒè¯é€»è¾‘åˆ†æ•£ï¼Œéš¾ä»¥ç»´æŠ¤
        // æ”¹è¿›ï¼šé›†ä¸­éªŒè¯é€»è¾‘ï¼Œæé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
        UserValidator.validate(request);
        
        User user = User.builder()
            .name(request.getName())
            .email(request.getEmail())
            .phone(request.getPhone()) // v1.2.0 æ–°å¢å­—æ®µ
            .status(UserStatus.PENDING_VERIFICATION)
            .createdAt(Instant.now())
            .build();
            
        return userRepository.save(user);
    }
}

// æ•°æ®åº“å˜æ›´è¯´æ˜
-- migration_v1.2.0_001_add_user_phone.sql
-- å˜æ›´è¯´æ˜ï¼šä¸ºç”¨æˆ·è¡¨æ·»åŠ æ‰‹æœºå·å­—æ®µ
-- å˜æ›´åŸå› ï¼šæ”¯æŒæ‰‹æœºå·æ³¨å†ŒåŠŸèƒ½
-- å½±å“èŒƒå›´ï¼šusersè¡¨ç»“æ„ï¼Œç›¸å…³æŸ¥è¯¢å’Œç´¢å¼•
-- é£é™©è¯„ä¼°ï¼šä½é£é™©ï¼Œæ–°å¢å­—æ®µï¼Œä¸å½±å“ç°æœ‰æ•°æ®
-- å›æ»šæ–¹æ¡ˆï¼šæ‰§è¡Œ migration_v1.2.0_001_rollback.sql
-- æµ‹è¯•çŠ¶æ€ï¼šå·²åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
-- è´Ÿè´£äººï¼šå¼ ä¸‰ (zhangsan@company.com)
-- å®¡æ‰¹äººï¼šæå›› (lisi@company.com)
-- è®¡åˆ’æ‰§è¡Œæ—¶é—´ï¼š2024-01-15 02:00 AM

ALTER TABLE users 
ADD COLUMN phone VARCHAR(20) COMMENT 'ç”¨æˆ·æ‰‹æœºå·ï¼Œæ”¯æŒä¸­å›½å¤§é™†æ‰‹æœºå·æ ¼å¼';

-- ä¸ºæ‰‹æœºå·å­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX idx_users_phone ON users(phone) 
WHERE phone IS NOT NULL;

-- æ›´æ–°ç°æœ‰ç”¨æˆ·çŠ¶æ€ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§
UPDATE users 
SET status = 'ACTIVE' 
WHERE status IS NULL 
  AND email_verified = 1 
  AND created_at < '2024-01-01';
```

### 4.20.3.2 ç‰ˆæœ¬è¯´æ˜æ–‡æ¡£æ£€æŸ¥ ğŸŸ¡

**1. æ£€æµ‹ç›®æ ‡**

a. æ¯ä¸ªç‰ˆæœ¬å‘å¸ƒéƒ½æœ‰å®Œæ•´çš„ç‰ˆæœ¬è¯´æ˜æ–‡æ¡£
b. ç‰ˆæœ¬è¯´æ˜åŒ…å«æ–°åŠŸèƒ½ã€æ”¹è¿›ã€ä¿®å¤å’Œå·²çŸ¥é—®é¢˜
c. ç‰ˆæœ¬å…¼å®¹æ€§å’Œå‡çº§æŒ‡å¯¼ä¿¡æ¯å®Œæ•´

**2. æ£€æµ‹æ–¹æ³•**

1. ç‰ˆæœ¬å‘å¸ƒæ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥
2. ç‰ˆæœ¬å·è§„èŒƒæ€§éªŒè¯ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰
3. å‘å¸ƒè¯´æ˜ä¸å®é™…å˜æ›´çš„ä¸€è‡´æ€§æ£€æŸ¥
4. ç‰ˆæœ¬ä¾èµ–å…³ç³»æ–‡æ¡£åŒ–æ£€æŸ¥

**3. é”™è¯¯ç¤ºä¾‹**

```markdown
<!-- âŒ ç‰ˆæœ¬è¯´æ˜æ–‡æ¡£ä¸å®Œæ•´æˆ–ä¸è§„èŒƒ -->

# Release Notes

## Version 1.2.0
å‘å¸ƒæ—¥æœŸï¼š2024-01-15

### æ›´æ–°å†…å®¹
- ä¿®å¤äº†ä¸€äº›bug
- æ·»åŠ äº†æ–°åŠŸèƒ½
- æ€§èƒ½ä¼˜åŒ–

### å®‰è£…è¯´æ˜
ä¸‹è½½æœ€æ–°ç‰ˆæœ¬å¹¶å®‰è£…

---

<!-- ç¼ºå°‘è¯¦ç»†ä¿¡æ¯çš„ç‰ˆæœ¬è¯´æ˜ -->
## v1.1.5 (2024-01-10)
- Bug fixes
- Minor improvements

<!-- æ²¡æœ‰ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜ -->
## v2.0.0 (2024-01-20)
- é‡å¤§æ›´æ–°
- æ–°æ¶æ„
```

**4. æ­£ç¡®ç¤ºä¾‹**

```markdown
<!-- âœ… æ­£ç¡®ï¼šå®Œæ•´çš„ç‰ˆæœ¬è¯´æ˜æ–‡æ¡£ -->

# Release Notes

## [1.2.0] - 2024-01-15

### ğŸ“‹ ç‰ˆæœ¬æ¦‚è¿°
æœ¬ç‰ˆæœ¬ä¸»è¦å¢åŠ äº†ç”¨æˆ·æ‰‹æœºå·éªŒè¯åŠŸèƒ½ï¼Œä¼˜åŒ–äº†è®¢å•å¤„ç†æ€§èƒ½ï¼Œå¹¶ä¿®å¤äº†å¤šä¸ªå®‰å…¨æ¼æ´ã€‚è¿™æ˜¯ä¸€ä¸ªå‘åå…¼å®¹çš„åŠŸèƒ½æ›´æ–°ç‰ˆæœ¬ã€‚

### âœ¨ æ–°å¢åŠŸèƒ½

#### ç”¨æˆ·ç®¡ç†å¢å¼º
- **æ‰‹æœºå·æ³¨å†Œç™»å½•** (#123)
  - æ”¯æŒä¸­å›½å¤§é™†æ‰‹æœºå·æ ¼å¼éªŒè¯
  - å®ç°æ‰‹æœºéªŒè¯ç å‘é€å’ŒéªŒè¯
  - æ·»åŠ æ‰‹æœºå·å”¯ä¸€æ€§æ£€æŸ¥
  - æ”¯æŒé‚®ç®±å’Œæ‰‹æœºå·åŒé‡éªŒè¯

- **ç”¨æˆ·çŠ¶æ€ç®¡ç†ä¼˜åŒ–** (#124)
  - æ–°å¢ç”¨æˆ·çŠ¶æ€ï¼šPENDING_PHONE_VERIFICATION
  - æ”¯æŒåˆ†æ­¥éª¤ç”¨æˆ·éªŒè¯æµç¨‹
  - æ·»åŠ ç”¨æˆ·æ¿€æ´»çŠ¶æ€è¿½è¸ª

#### APIå¢å¼º
- **æ–°å¢æ¥å£**ï¼š
  - `POST /api/auth/send-sms-code` - å‘é€æ‰‹æœºéªŒè¯ç 
  - `POST /api/auth/verify-phone` - éªŒè¯æ‰‹æœºå·
  - `GET /api/users/profile/verification-status` - è·å–éªŒè¯çŠ¶æ€

### ğŸ”§ æ”¹è¿›ä¼˜åŒ–

#### æ€§èƒ½ä¼˜åŒ–
- **è®¢å•æŸ¥è¯¢æ€§èƒ½æå‡ 50%** (#125)
  - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ç´¢å¼•
  - å®ç°æŸ¥è¯¢ç»“æœç¼“å­˜
  - å‡å°‘N+1æŸ¥è¯¢é—®é¢˜

- **ç”¨æˆ·è®¤è¯æµç¨‹ä¼˜åŒ–** (#126)
  - JWT token æœ‰æ•ˆæœŸä¼˜åŒ–
  - å®ç° token è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
  - å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°

#### ç”¨æˆ·ä½“éªŒæ”¹è¿›
- ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- æ”¹è¿›APIå“åº”æ—¶é—´ï¼ˆå¹³å‡å‡å°‘30%ï¼‰
- ä¼˜åŒ–æ—¥å¿—è®°å½•ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

### ğŸ› é—®é¢˜ä¿®å¤

#### å®‰å…¨ä¿®å¤
- **é«˜å±**: ä¿®å¤ç”¨æˆ·æƒé™ç»•è¿‡æ¼æ´ (#127)
  - åŠ å¼ºæƒé™éªŒè¯é€»è¾‘
  - ä¿®å¤è§’è‰²æƒé™æ£€æŸ¥ç¼ºé™·
  - æ·»åŠ æ•æ„Ÿæ“ä½œå®¡è®¡æ—¥å¿—

- **ä¸­å±**: ä¿®å¤SQLæ³¨å…¥é£é™© (#128)
  - ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æ›¿æ¢å­—ç¬¦ä¸²æ‹¼æ¥
  - åŠ å¼ºè¾“å…¥å‚æ•°éªŒè¯
  - æ·»åŠ SQLæ³¨å…¥æ£€æµ‹æœºåˆ¶

#### åŠŸèƒ½ä¿®å¤
- ä¿®å¤å¹¶å‘åˆ›å»ºè®¢å•æ—¶çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ (#129)
- ä¿®å¤ç”¨æˆ·å¯†ç é‡ç½®é‚®ä»¶å‘é€å¤±è´¥é—®é¢˜ (#130)
- ä¿®å¤åˆ†é¡µæŸ¥è¯¢åœ¨å¤§æ•°æ®é‡æ—¶çš„æ€§èƒ½é—®é¢˜ (#131)

### âš ï¸ é‡è¦å˜æ›´

#### APIå˜æ›´ï¼ˆå‘åå…¼å®¹ï¼‰
- ç”¨æˆ·æ³¨å†Œæ¥å£æ–°å¢å¯é€‰å­—æ®µ `phone`
- ç”¨æˆ·ä¿¡æ¯æ¥å£å“åº”æ–°å¢ `phoneVerified` å­—æ®µ
- é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€ï¼Œæ·»åŠ  `errorCode` å­—æ®µ

#### æ•°æ®åº“å˜æ›´
- æ–°å¢è¡¨ï¼š`sms_verification_codes`
- ç”¨æˆ·è¡¨æ–°å¢å­—æ®µï¼š`phone`, `phone_verified_at`
- æ–°å¢ç´¢å¼•ï¼š`idx_users_phone`, `idx_sms_codes_phone`

### ğŸ“¦ ä¾èµ–æ›´æ–°

#### ä¸»è¦ä¾èµ–
- Spring Boot: 2.7.8 â†’ 2.7.10
- Spring Security: 5.7.6 â†’ 5.7.8
- MySQL Connector: 8.0.32 â†’ 8.0.33
- Redis: 6.2.10 â†’ 6.2.11

#### æ–°å¢ä¾èµ–
- `spring-boot-starter-data-redis`: 2.7.10
- `aliyun-java-sdk-dysmsapi`: 2.2.1

### ğŸ”„ å…¼å®¹æ€§è¯´æ˜

#### å‘åå…¼å®¹
- âœ… APIæ¥å£å®Œå…¨å‘åå…¼å®¹
- âœ… æ•°æ®åº“ç»“æ„å‘åå…¼å®¹
- âœ… é…ç½®æ–‡ä»¶å‘åå…¼å®¹

#### æœ€ä½è¦æ±‚
- Java: 8+ (æ¨è 11+)
- MySQL: 5.7+ (æ¨è 8.0+)
- Redis: 6.0+ (æ–°å¢è¦æ±‚)

### ğŸ“š å‡çº§æŒ‡å—

#### è‡ªåŠ¨å‡çº§ï¼ˆæ¨èï¼‰
```bash
# 1. å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p your_database > backup_v1.1.x.sql

# 2. åœæ­¢åº”ç”¨
sudo systemctl stop your-app

# 3. æ›´æ–°åº”ç”¨
wget https://releases.example.com/v1.2.0/app.jar

# 4. è¿è¡Œæ•°æ®åº“è¿ç§»
java -jar app.jar --spring.profiles.active=migration

# 5. å¯åŠ¨åº”ç”¨
sudo systemctl start your-app
```

#### æ‰‹åŠ¨å‡çº§
1. **ç¯å¢ƒå‡†å¤‡**
   - å®‰è£… Redis 6.0+
   - é…ç½® Redis è¿æ¥ä¿¡æ¯

2. **æ•°æ®åº“è¿ç§»**
   - æ‰§è¡Œ `migrations/v1.2.0/*.sql`
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

3. **é…ç½®æ›´æ–°**
   - æ·»åŠ  Redis é…ç½®
   - é…ç½®çŸ­ä¿¡æœåŠ¡å‚æ•°

4. **éªŒè¯å‡çº§**
   - æ£€æŸ¥åº”ç”¨å¯åŠ¨æ—¥å¿—
   - éªŒè¯æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
   - è¿è¡Œå¥åº·æ£€æŸ¥

### ğŸ§ª æµ‹è¯•è¦†ç›–
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼š92%
- é›†æˆæµ‹è¯•è¦†ç›–ç‡ï¼š85%
- APIæµ‹è¯•è¦†ç›–ç‡ï¼š100%
- æ€§èƒ½æµ‹è¯•ï¼šé€šè¿‡
- å®‰å…¨æµ‹è¯•ï¼šé€šè¿‡

### ğŸ“Š æ€§èƒ½æŒ‡æ ‡
- APIå“åº”æ—¶é—´ï¼šå¹³å‡å‡å°‘30%
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ï¼šæå‡50%
- å†…å­˜ä½¿ç”¨ï¼šä¼˜åŒ–15%
- å¹¶å‘å¤„ç†èƒ½åŠ›ï¼šæå‡25%

### ğŸ”— ç›¸å…³é“¾æ¥
- [å®Œæ•´å˜æ›´æ—¥å¿—](CHANGELOG.md)
- [APIæ–‡æ¡£](https://api-docs.example.com/v1.2.0)
- [è¿ç§»æŒ‡å—](docs/migration/v1.2.0.md)
- [å·²çŸ¥é—®é¢˜](docs/known-issues.md)

### ğŸ‘¥ è´¡çŒ®è€…
æ„Ÿè°¢ä»¥ä¸‹è´¡çŒ®è€…å¯¹æœ¬ç‰ˆæœ¬çš„è´¡çŒ®ï¼š
- å¼ ä¸‰ (@zhangsan) - æ‰‹æœºå·éªŒè¯åŠŸèƒ½
- æå›› (@lisi) - æ€§èƒ½ä¼˜åŒ–
- ç‹äº” (@wangwu) - å®‰å…¨ä¿®å¤
- èµµå…­ (@zhaoliu) - æµ‹è¯•å’Œæ–‡æ¡£

### ğŸ“ æ”¯æŒ
å¦‚æœåœ¨å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ [æ•…éšœæ’é™¤æŒ‡å—](docs/troubleshooting.md)
2. æœç´¢ [å·²çŸ¥é—®é¢˜](https://github.com/example/issues)
3. è”ç³»æŠ€æœ¯æ”¯æŒï¼šsupport@example.com
```

### 4.20.3.3 è¿ç§»æŒ‡å—å®Œæ•´æ€§æ£€æŸ¥ ğŸŸ¢

**1. æ£€æµ‹ç›®æ ‡**

a. é‡å¤§ç‰ˆæœ¬æ›´æ–°æä¾›è¯¦ç»†çš„è¿ç§»æŒ‡å—
b. è¿ç§»æŒ‡å—åŒ…å«å…·ä½“çš„æ“ä½œæ­¥éª¤å’Œä»£ç ç¤ºä¾‹
c. æä¾›è¿ç§»å‰åçš„å¯¹æ¯”å’ŒéªŒè¯æ–¹æ³•

**2. æ£€æµ‹æ–¹æ³•**

1. è¿ç§»æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥
2. è¿ç§»æ­¥éª¤å¯æ‰§è¡Œæ€§éªŒè¯
3. è¿ç§»è„šæœ¬å’Œå·¥å…·çš„æœ‰æ•ˆæ€§æµ‹è¯•
4. è¿ç§»é£é™©è¯„ä¼°æ–‡æ¡£æ£€æŸ¥

**3. é”™è¯¯ç¤ºä¾‹**

```markdown
<!-- âŒ è¿ç§»æŒ‡å—ä¸å®Œæ•´æˆ–ä¸æ¸…æ™° -->

# å‡çº§åˆ° v2.0.0

## å˜æ›´
- APIæ¥å£æœ‰å˜åŒ–
- æ•°æ®åº“ç»“æ„è°ƒæ•´
- é…ç½®æ–‡ä»¶æ ¼å¼æ›´æ–°

## å‡çº§æ­¥éª¤
1. å¤‡ä»½æ•°æ®
2. æ›´æ–°ä»£ç 
3. è¿è¡Œè¿ç§»
4. é‡å¯æœåŠ¡

## æ³¨æ„äº‹é¡¹
- å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜
- å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
```

**4. æ­£ç¡®ç¤ºä¾‹**

```markdown
<!-- âœ… æ­£ç¡®ï¼šå®Œæ•´è¯¦ç»†çš„è¿ç§»æŒ‡å— -->

# è¿ç§»æŒ‡å—ï¼šä» v1.x å‡çº§åˆ° v2.0.0

## ğŸ“‹ è¿ç§»æ¦‚è¿°

v2.0.0 æ˜¯ä¸€ä¸ªé‡å¤§ç‰ˆæœ¬æ›´æ–°ï¼ŒåŒ…å«ä»¥ä¸‹é‡è¦å˜æ›´ï¼š
- å¾®æœåŠ¡æ¶æ„é‡æ„
- APIæ¥å£é‡æ–°è®¾è®¡
- æ•°æ®åº“ç»“æ„ä¼˜åŒ–
- é…ç½®ç®¡ç†æ–¹å¼å˜æ›´

**é¢„è®¡è¿ç§»æ—¶é—´**ï¼š2-4å°æ—¶ï¼ˆå–å†³äºæ•°æ®é‡ï¼‰
**åœæœºæ—¶é—´**ï¼š30-60åˆ†é’Ÿ
**é£é™©ç­‰çº§**ï¼šä¸­ç­‰

## âš ï¸ é‡è¦æé†’

### è¿ç§»å‰å¿…è¯»
- ğŸ”´ **ä¸å¯é€†æ“ä½œ**ï¼šæœ¬æ¬¡å‡çº§åŒ…å«æ•°æ®ç»“æ„å˜æ›´ï¼Œæ— æ³•ç›´æ¥å›æ»š
- ğŸŸ¡ **APIä¸å…¼å®¹**ï¼šå®¢æˆ·ç«¯ä»£ç éœ€è¦ç›¸åº”è°ƒæ•´
- ğŸŸ¢ **æ•°æ®ä¿ç•™**ï¼šæ‰€æœ‰ä¸šåŠ¡æ•°æ®å°†å®Œæ•´ä¿ç•™

### ç¯å¢ƒè¦æ±‚
- Java 11+ ï¼ˆä» Java 8+ å‡çº§ï¼‰
- MySQL 8.0+ ï¼ˆä» 5.7+ å‡çº§ï¼‰
- Redis 6.0+
- Elasticsearch 7.x+

## ğŸ”„ è¿ç§»æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡å·¥ä½œï¼ˆé¢„è®¡30åˆ†é’Ÿï¼‰

#### 1.1 ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥å½“å‰ç‰ˆæœ¬
curl http://localhost:8080/actuator/info

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -u root -p -e "SELECT VERSION();"

# æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘éœ€è¦å½“å‰æ•°æ®é‡çš„2å€ç©ºé—´ï¼‰
df -h
```

#### 1.2 æ•°æ®å¤‡ä»½
```bash
# 1. å®Œæ•´æ•°æ®åº“å¤‡ä»½
mysqldump -u root -p --single-transaction --routines --triggers \
  your_database > backup_v1_$(date +%Y%m%d_%H%M%S).sql

# 2. é…ç½®æ–‡ä»¶å¤‡ä»½
cp -r /etc/your-app/ /backup/config_v1_$(date +%Y%m%d_%H%M%S)/

# 3. åº”ç”¨æ–‡ä»¶å¤‡ä»½
cp your-app-v1.jar /backup/app_v1_$(date +%Y%m%d_%H%M%S).jar

# 4. éªŒè¯å¤‡ä»½å®Œæ•´æ€§
mysql -u root -p your_database < backup_v1_*.sql --dry-run
```

#### 1.3 ä¾èµ–ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£… Java 11
sudo apt update
sudo apt install openjdk-11-jdk

# å®‰è£… Redis 6.0+
wget http://download.redis.io/redis-stable.tar.gz
tar xzf redis-stable.tar.gz
cd redis-stable
make && sudo make install

# å®‰è£… Elasticsearch
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.0-linux-x86_64.tar.gz
```

### ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®è¿ç§»ï¼ˆé¢„è®¡60-120åˆ†é’Ÿï¼‰

#### 2.1 åœæ­¢æœåŠ¡
```bash
# åœæ­¢åº”ç”¨æœåŠ¡
sudo systemctl stop your-app

# åœæ­¢ç›¸å…³æœåŠ¡
sudo systemctl stop nginx
sudo systemctl stop your-app-worker

# ç¡®è®¤æœåŠ¡å·²åœæ­¢
sudo systemctl status your-app
```

#### 2.2 æ•°æ®åº“ç»“æ„è¿ç§»
```bash
# 1. æ‰§è¡Œç»“æ„è¿ç§»è„šæœ¬
mysql -u root -p your_database < migrations/v2.0.0/001_schema_migration.sql

# 2. æ•°æ®è½¬æ¢
mysql -u root -p your_database < migrations/v2.0.0/002_data_transformation.sql

# 3. ç´¢å¼•é‡å»º
mysql -u root -p your_database < migrations/v2.0.0/003_index_optimization.sql

# 4. éªŒè¯æ•°æ®å®Œæ•´æ€§
mysql -u root -p your_database < migrations/v2.0.0/004_data_validation.sql
```

#### 2.3 é…ç½®æ–‡ä»¶è¿ç§»
```bash
# ä½¿ç”¨è¿ç§»å·¥å…·è½¬æ¢é…ç½®
java -jar migration-tool-v2.0.0.jar \
  --input /etc/your-app/application-v1.yml \
  --output /etc/your-app/application-v2.yml

# æ‰‹åŠ¨è°ƒæ•´ç‰¹æ®Šé…ç½®
vim /etc/your-app/application-v2.yml
```

### ç¬¬ä¸‰é˜¶æ®µï¼šåº”ç”¨éƒ¨ç½²ï¼ˆé¢„è®¡30åˆ†é’Ÿï¼‰

#### 3.1 éƒ¨ç½²æ–°ç‰ˆæœ¬
```bash
# 1. ä¸‹è½½æ–°ç‰ˆæœ¬
wget https://releases.example.com/v2.0.0/your-app-v2.0.0.jar

# 2. æ›´æ–°åº”ç”¨æ–‡ä»¶
sudo cp your-app-v2.0.0.jar /opt/your-app/your-app.jar

# 3. æ›´æ–°å¯åŠ¨è„šæœ¬
sudo cp scripts/your-app-v2.service /etc/systemd/system/
sudo systemctl daemon-reload
```

#### 3.2 å¯åŠ¨æœåŠ¡
```bash
# 1. å¯åŠ¨ä¾èµ–æœåŠ¡
sudo systemctl start redis
sudo systemctl start elasticsearch

# 2. å¯åŠ¨åº”ç”¨ï¼ˆä½¿ç”¨è¿ç§»æ¨¡å¼ï¼‰
sudo systemctl start your-app

# 3. æ£€æŸ¥å¯åŠ¨æ—¥å¿—
sudo journalctl -u your-app -f
```

### ç¬¬å››é˜¶æ®µï¼šéªŒè¯æµ‹è¯•ï¼ˆé¢„è®¡30åˆ†é’Ÿï¼‰

#### 4.1 å¥åº·æ£€æŸ¥
```bash
# 1. åº”ç”¨å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health

# 2. æ•°æ®åº“è¿æ¥æ£€æŸ¥
curl http://localhost:8080/actuator/health/db

# 3. ç¼“å­˜è¿æ¥æ£€æŸ¥
curl http://localhost:8080/actuator/health/redis
```

#### 4.2 åŠŸèƒ½éªŒè¯
```bash
# 1. ç”¨æˆ·ç™»å½•æµ‹è¯•
curl -X POST http://localhost:8080/api/v2/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test@example.com","password":"password"}'

# 2. æ•°æ®æŸ¥è¯¢æµ‹è¯•
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/api/v2/users/profile

# 3. ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•
curl -X POST http://localhost:8080/api/v2/orders \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"productId":1,"quantity":2}'
```

#### 4.3 æ€§èƒ½éªŒè¯
```bash
# 1. å“åº”æ—¶é—´æµ‹è¯•
ab -n 1000 -c 10 http://localhost:8080/api/v2/health

# 2. å†…å­˜ä½¿ç”¨æ£€æŸ¥
ps aux | grep java
free -h

# 3. æ•°æ®åº“æ€§èƒ½æ£€æŸ¥
mysql -u root -p -e "SHOW PROCESSLIST;"
```

## ğŸ”§ APIè¿ç§»æŒ‡å—

### è®¤è¯æ¥å£å˜æ›´

#### v1.x æ¥å£
```bash
# æ—§ç‰ˆæœ¬ç™»å½•
POST /api/auth/login
{
  "email": "user@example.com",
  "password": "password"
}

# å“åº”
{
  "token": "jwt-token",
  "expires": 3600
}
```

#### v2.0 æ¥å£
```bash
# æ–°ç‰ˆæœ¬ç™»å½•
POST /api/v2/auth/login
{
  "username": "user@example.com",  # email æ”¹ä¸º username
  "password": "password",
  "deviceId": "device-123"          # æ–°å¢è®¾å¤‡ID
}

# å“åº”
{
  "accessToken": "jwt-access-token",
  "refreshToken": "jwt-refresh-token",
  "expiresIn": 3600,
  "tokenType": "Bearer"
}
```

#### å®¢æˆ·ç«¯ä»£ç è¿ç§»
```javascript
// v1.x å®¢æˆ·ç«¯ä»£ç 
const loginV1 = async (email, password) => {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  const data = await response.json();
  localStorage.setItem('token', data.token);
};

// v2.0 å®¢æˆ·ç«¯ä»£ç 
const loginV2 = async (username, password, deviceId) => {
  const response = await fetch('/api/v2/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password, deviceId })
  });
  const data = await response.json();
  localStorage.setItem('accessToken', data.accessToken);
  localStorage.setItem('refreshToken', data.refreshToken);
};
```

### ç”¨æˆ·æ¥å£å˜æ›´

#### æ¥å£è·¯å¾„å˜æ›´
```bash
# v1.x
GET /api/users/{id}
POST /api/users
PUT /api/users/{id}
DELETE /api/users/{id}

# v2.0
GET /api/v2/users/{id}
POST /api/v2/users
PATCH /api/v2/users/{id}  # PUT æ”¹ä¸º PATCH
DELETE /api/v2/users/{id}
```

#### å“åº”æ ¼å¼å˜æ›´
```json
// v1.x å“åº”æ ¼å¼
{
  "id": 1,
  "name": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "created_at": "2024-01-01T00:00:00Z"
}

// v2.0 å“åº”æ ¼å¼
{
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "phone": "+86-13800138000",
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-01-01T00:00:00Z"
  },
  "meta": {
    "version": "v2.0",
    "timestamp": "2024-01-15T10:30:00Z"
  }
}
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# é”™è¯¯ä¿¡æ¯
Communications link failure

# è§£å†³æ–¹æ¡ˆ
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
sudo systemctl status mysql

# æ£€æŸ¥è¿æ¥é…ç½®
grep -r "datasource" /etc/your-app/

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u your_user -p -h localhost your_database
```

#### 2. å†…å­˜ä¸è¶³
```bash
# é”™è¯¯ä¿¡æ¯
OutOfMemoryError: Java heap space

# è§£å†³æ–¹æ¡ˆ
# è°ƒæ•´JVMå‚æ•°
sudo vim /etc/systemd/system/your-app.service
# æ·»åŠ ï¼š-Xmx2g -Xms1g

# é‡å¯æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl restart your-app
```

#### 3. APIè°ƒç”¨å¤±è´¥
```bash
# é”™è¯¯ä¿¡æ¯
404 Not Found

# è§£å†³æ–¹æ¡ˆ
# æ£€æŸ¥APIç‰ˆæœ¬
curl http://localhost:8080/api/v2/health

# æ›´æ–°å®¢æˆ·ç«¯ä»£ç ä¸­çš„APIè·¯å¾„
# /api/users -> /api/v2/users
```

### å›æ»šæ–¹æ¡ˆ

å¦‚æœè¿ç§»å¤±è´¥ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤å›æ»šï¼š

```bash
# 1. åœæ­¢v2.0æœåŠ¡
sudo systemctl stop your-app

# 2. æ¢å¤æ•°æ®åº“
mysql -u root -p your_database < backup_v1_*.sql

# 3. æ¢å¤åº”ç”¨æ–‡ä»¶
sudo cp /backup/app_v1_*.jar /opt/your-app/your-app.jar

# 4. æ¢å¤é…ç½®æ–‡ä»¶
sudo cp -r /backup/config_v1_*/* /etc/your-app/

# 5. å¯åŠ¨v1.xæœåŠ¡
sudo systemctl start your-app
```

## ğŸ“ æ”¯æŒä¸å¸®åŠ©

### æŠ€æœ¯æ”¯æŒ
- ğŸ“§ é‚®ç®±ï¼šsupport@example.com
- ğŸ“± ç”µè¯ï¼š400-123-4567
- ğŸ’¬ åœ¨çº¿å®¢æœï¼šhttps://support.example.com

### æ–‡æ¡£èµ„æº
- [APIæ–‡æ¡£ v2.0](https://api-docs.example.com/v2.0)
- [å¼€å‘è€…æŒ‡å—](https://docs.example.com/dev-guide)
- [å¸¸è§é—®é¢˜](https://docs.example.com/faq)

### ç¤¾åŒºæ”¯æŒ
- [GitHub Issues](https://github.com/example/your-app/issues)
- [å¼€å‘è€…è®ºå›](https://forum.example.com)
- [æŠ€æœ¯åšå®¢](https://blog.example.com)
```