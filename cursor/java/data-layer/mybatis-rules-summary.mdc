# MyBatis/MyBatis-Plus è§„èŒƒæ±‡æ€» (æ•°æ®å±‚è§„åˆ™)
> MyBatiså’ŒMyBatis-Plusçš„æ ¸å¿ƒä½¿ç”¨è§„èŒƒå’Œå…³é”®è¦ç‚¹

## ğŸ¯ æ ¸å¿ƒè§„èŒƒè¦ç‚¹

### 1. å¿…é¡»é…ç½®çš„æ’ä»¶
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
@Configuration
@MapperScan(basePackages = "com.example.mapper")
public class MyBatisPlusConfig {
    
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        
        // å¿…é¡»é…ç½®ï¼šåˆ†é¡µæ’ä»¶
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        
        // å¿…é¡»é…ç½®ï¼šä¹è§‚é”æ’ä»¶
        interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
        
        // å¿…é¡»é…ç½®ï¼šé˜²æ”»å‡»æ’ä»¶
        interceptor.addInnerInterceptor(new BlockAttackInnerInterceptor());
        
        return interceptor;
    }
}
// [AI-BLOCK-END]
```

### 2. å®ä½“ç±»å¿…é¡»è§„èŒƒ
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
@Data
@TableName("users")
public class User extends BaseEntity {
    
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;
    
    @TableField("username")
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    private String username;
    
    @Version
    @TableField("version")
    private Integer version;
    
    @TableLogic
    @TableField("deleted")
    private Integer deleted;
}

// åŸºç¡€å®ä½“ç±»
@Data
public abstract class BaseEntity {
    
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;
    
    @TableField(value = "create_by", fill = FieldFill.INSERT)
    private String createBy;
    
    @TableField(value = "update_by", fill = FieldFill.INSERT_UPDATE)
    private String updateBy;
}
// [AI-BLOCK-END]
```

### 3. Mapperæ¥å£å¿…é¡»è§„èŒƒ
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
@Mapper
public interface UserMapper extends BaseMapper<User> {
    
    // ç®€å•æŸ¥è¯¢ï¼šä½¿ç”¨æ³¨è§£
    @Select("SELECT * FROM users WHERE username = #{username} AND deleted = 0")
    User selectByUsername(@Param("username") String username);
    
    // å¤æ‚æŸ¥è¯¢ï¼šä½¿ç”¨XMLæ˜ å°„
    IPage<User> selectUserPage(IPage<User> page, @Param("query") UserQueryDTO queryDTO);
    
    // æ‰¹é‡æ“ä½œï¼šä½¿ç”¨XMLæ˜ å°„
    int insertBatch(@Param("users") List<User> users);
    
    // ç»Ÿè®¡æŸ¥è¯¢ï¼šä½¿ç”¨XMLæ˜ å°„
    UserStatisticsVO selectUserStatistics(@Param("deptId") Long deptId);
}
// [AI-BLOCK-END]
```

### 4. Serviceå±‚å¿…é¡»è§„èŒƒ
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
@Service
@Transactional(rollbackFor = Exception.class)
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    
    // ä½¿ç”¨æ¡ä»¶æ„é€ å™¨è¿›è¡ŒæŸ¥è¯¢
    @Override
    public IPage<User> getUserPage(UserQueryDTO queryDTO, int pageNum, int pageSize) {
        Page<User> page = new Page<>(pageNum, pageSize);
        
        LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.like(StringUtils.isNotBlank(queryDTO.getUsername()), 
                         User::getUsername, queryDTO.getUsername())
                   .eq(queryDTO.getStatus() != null, 
                       User::getStatus, queryDTO.getStatus())
                   .orderByDesc(User::getCreateTime);
        
        return this.page(page, queryWrapper);
    }
    
    // ä½¿ç”¨æ¡ä»¶æ„é€ å™¨è¿›è¡Œæ›´æ–°
    @Override
    public boolean updateUser(Long userId, UserUpdateDTO updateDTO) {
        LambdaUpdateWrapper<User> updateWrapper = new LambdaUpdateWrapper<>();
        updateWrapper.eq(User::getId, userId);
        
        if (StringUtils.isNotBlank(updateDTO.getEmail())) {
            updateWrapper.set(User::getEmail, updateDTO.getEmail());
        }
        
        return this.update(updateWrapper);
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ æ ¸å¿ƒé…ç½®è¦æ±‚

### 1. åº”ç”¨é…ç½®æ–‡ä»¶
```yaml
# [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
mybatis-plus:
  global-config:
    db-config:
      id-type: ASSIGN_ID
      table-underline: true
      column-underline: true
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true
    lazy-loading-enabled: true
    default-statement-timeout: 30
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
# [AI-BLOCK-END]
```

### 2. è‡ªåŠ¨å¡«å……é…ç½®
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
@Component
public class CustomMetaObjectHandler implements MetaObjectHandler {
    
    @Override
    public void insertFill(MetaObject metaObject) {
        this.strictInsertFill(metaObject, "createTime", LocalDateTime.class, LocalDateTime.now());
        this.strictInsertFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now());
        this.strictInsertFill(metaObject, "createBy", String.class, getCurrentUserId());
        this.strictInsertFill(metaObject, "updateBy", String.class, getCurrentUserId());
    }
    
    @Override
    public void updateFill(MetaObject metaObject) {
        this.strictUpdateFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now());
        this.strictUpdateFill(metaObject, "updateBy", String.class, getCurrentUserId());
    }
}
// [AI-BLOCK-END]
```

## âš ï¸ å…³é”®ç¦æ­¢è¡Œä¸º

### 1. é…ç½®ç¦ä»¤
- **ç¦æ­¢è·³è¿‡åˆ†é¡µæ’ä»¶é…ç½®**
- **ç¦æ­¢ä¸é…ç½®é€»è¾‘åˆ é™¤**
- **ç¦æ­¢ä¸é…ç½®è‡ªåŠ¨å¡«å……**
- **ç¦æ­¢ç¡¬ç¼–ç æ•°æ®åº“é…ç½®**

### 2. å®ä½“ç±»ç¦ä»¤
- **ç¦æ­¢ä¸ç»§æ‰¿BaseEntity**
- **ç¦æ­¢ä¸ä½¿ç”¨@TableNameæ³¨è§£**
- **ç¦æ­¢ä¸é…ç½®@TableLogic**
- **ç¦æ­¢ä¸é…ç½®@Versionï¼ˆé‡è¦å®ä½“ï¼‰**

### 3. Mapperæ¥å£ç¦ä»¤
- **ç¦æ­¢ä¸ç»§æ‰¿BaseMapper**
- **ç¦æ­¢ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²å­—æ®µå**
- **ç¦æ­¢å¤šå‚æ•°ä¸ä½¿ç”¨@Param**
- **ç¦æ­¢å¤æ‚æŸ¥è¯¢ä½¿ç”¨æ³¨è§£**

### 4. Serviceå±‚ç¦ä»¤
- **ç¦æ­¢ä¸ä½¿ç”¨æ¡ä»¶æ„é€ å™¨**
- **ç¦æ­¢ä¸é…ç½®äº‹åŠ¡æ³¨è§£**
- **ç¦æ­¢ä¸å¤„ç†å¼‚å¸¸**
- **ç¦æ­¢ä¸æ¸…ç†ç¼“å­˜**

### 5. æ€§èƒ½ç¦ä»¤
- **ç¦æ­¢ä¸ä½¿ç”¨åˆ†é¡µ**
- **ç¦æ­¢æŸ¥è¯¢å…¨éƒ¨å­—æ®µ**
- **ç¦æ­¢N+1æŸ¥è¯¢**
- **ç¦æ­¢ä¸ä½¿ç”¨ç´¢å¼•å­—æ®µ**

## ğŸš€ æœ€ä½³å®è·µè¦ç‚¹

### 1. æŸ¥è¯¢ä¼˜åŒ–
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
// âœ… æ­£ç¡®ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼
LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<>();
queryWrapper.eq(User::getStatus, 1)
           .like(User::getUsername, "admin")
           .orderByDesc(User::getCreateTime);

// âŒ é”™è¯¯ï¼šä½¿ç”¨å­—ç¬¦ä¸²å­—æ®µå
QueryWrapper<User> queryWrapper = new QueryWrapper<>();
queryWrapper.eq("status", 1)
           .like("username", "admin")
           .orderByDesc("create_time");
// [AI-BLOCK-END]
```

### 2. æ‰¹é‡æ“ä½œ
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ‰¹é‡ä¿å­˜
List<User> users = buildUserList();
userService.saveBatch(users, 1000); // æ¯æ‰¹1000æ¡

// âŒ é”™è¯¯ï¼šå¾ªç¯å•æ¡ä¿å­˜
for (User user : users) {
    userService.save(user);
}
// [AI-BLOCK-END]
```

### 3. åˆ†é¡µæŸ¥è¯¢
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
// âœ… æ­£ç¡®ï¼šä½¿ç”¨åˆ†é¡µæ’ä»¶
Page<User> page = new Page<>(pageNum, pageSize);
IPage<User> result = userService.page(page, queryWrapper);

// âŒ é”™è¯¯ï¼šä¸ä½¿ç”¨åˆ†é¡µ
List<User> allUsers = userService.list(queryWrapper);
// [AI-BLOCK-END]
```

### 4. ç¼“å­˜ä½¿ç”¨
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
// âœ… æ­£ç¡®ï¼šå…ˆæŸ¥ç¼“å­˜ï¼Œå†æŸ¥æ•°æ®åº“
public User getUserById(Long userId) {
    String cacheKey = "user:id:" + userId;
    User cachedUser = (User) redisTemplate.opsForValue().get(cacheKey);
    if (cachedUser != null) {
        return cachedUser;
    }
    
    User user = userMapper.selectById(userId);
    if (user != null) {
        redisTemplate.opsForValue().set(cacheKey, user, Duration.ofMinutes(30));
    }
    return user;
}
// [AI-BLOCK-END]
```

## ğŸ“Š æ€§èƒ½ç›‘æ§è¦ç‚¹

### 1. SQLæ€§èƒ½ç›‘æ§
- ç›‘æ§æ…¢SQLï¼ˆ>1ç§’ï¼‰
- ç›‘æ§SQLæ‰§è¡Œé¢‘ç‡
- ç›‘æ§æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
- ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡

### 2. å…³é”®æŒ‡æ ‡
- æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms
- æ‰¹é‡æ“ä½œæ¯æ‰¹ â‰¤ 1000æ¡
- åˆ†é¡µå¤§å° â‰¤ 100æ¡
- è¿æ¥æ± ä½¿ç”¨ç‡ < 80%

## ğŸ”§ ä»£ç ç”Ÿæˆè§„èŒƒ

### 1. ä»£ç ç”Ÿæˆå™¨é…ç½®
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
@Test
public void generateCode() {
    AutoGenerator generator = new AutoGenerator();
    
    // å…¨å±€é…ç½®
    GlobalConfig globalConfig = new GlobalConfig();
    globalConfig.setOutputDir(System.getProperty("user.dir") + "/src/main/java");
    globalConfig.setAuthor("ç³»ç»Ÿç”Ÿæˆ");
    globalConfig.setServiceName("%sService");
    globalConfig.setIdType(IdType.ASSIGN_ID);
    
    // ç­–ç•¥é…ç½®
    StrategyConfig strategyConfig = new StrategyConfig();
    strategyConfig.setEntityLombokModel(true);
    strategyConfig.setRestControllerStyle(true);
    strategyConfig.setLogicDeleteFieldName("deleted");
    strategyConfig.setVersionFieldName("version");
    
    generator.setGlobalConfig(globalConfig);
    generator.setStrategy(strategyConfig);
    generator.execute();
}
// [AI-BLOCK-END]
```

è¿™ä¸ªè§„èŒƒæ±‡æ€»æ–‡æ¡£æä¾›äº†MyBatiså’ŒMyBatis-Plusä½¿ç”¨çš„æ ¸å¿ƒè¦ç‚¹ï¼ŒåŒ…æ‹¬ï¼š

1. **å¿…é¡»é…ç½®çš„æ’ä»¶**ï¼šåˆ†é¡µã€ä¹è§‚é”ã€é˜²æ”»å‡»æ’ä»¶
2. **å®ä½“ç±»è§„èŒƒ**ï¼šç»§æ‰¿BaseEntityã€ä½¿ç”¨æ³¨è§£ã€é…ç½®é€»è¾‘åˆ é™¤
3. **Mapperæ¥å£è§„èŒƒ**ï¼šç»§æ‰¿BaseMapperã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼ã€XMLæ˜ å°„
4. **Serviceå±‚è§„èŒƒ**ï¼šæ¡ä»¶æ„é€ å™¨ã€äº‹åŠ¡ç®¡ç†ã€ç¼“å­˜ç­–ç•¥
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†é¡µæŸ¥è¯¢ã€æ‰¹é‡æ“ä½œã€ç¼“å­˜ä½¿ç”¨
6. **ç¦æ­¢è¡Œä¸º**ï¼šæ˜ç¡®åˆ—å‡ºä¸å…è®¸çš„åšæ³•

æ‰€æœ‰ä»£ç ç¤ºä¾‹éƒ½ä½¿ç”¨äº†AI-BLOCKæ ‡è®°ï¼Œä¾¿äºAIå·¥å…·è¯†åˆ«å’Œåº”ç”¨ã€‚
description:
globs:
alwaysApply: false
---
