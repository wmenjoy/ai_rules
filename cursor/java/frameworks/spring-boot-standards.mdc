# Spring Bootç¼–ç¨‹è§„èŒƒ

## ğŸ¯ è§„èŒƒç›®æ ‡
- å»ºç«‹Spring Bootåº”ç”¨çš„ç»Ÿä¸€å¼€å‘æ ‡å‡†
- ç¡®ä¿åº”ç”¨çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œé«˜æ€§èƒ½
- æä¾›å®‰å…¨å¯é çš„ä¼ä¸šçº§åº”ç”¨å¼€å‘æŒ‡å¯¼
- ä¼˜åŒ–Spring Bootç‰¹æ€§çš„ä½¿ç”¨æ–¹å¼

## ğŸ“‹ åº”ç”¨é…ç½®è§„èŒƒ

### é…ç½®æ–‡ä»¶ç»„ç»‡
```yaml
# âœ… application.yml - ä¸»é…ç½®æ–‡ä»¶
spring:
  profiles:
    active: @spring.profiles.active@  # Maven profile æ³¨å…¥
  application:
    name: footstone-demo
    
server:
  port: 8080
  servlet:
    context-path: /api
    
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
```

```yaml
# âœ… application-dev.yml - å¼€å‘ç¯å¢ƒé…ç½®
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/footstone_dev?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    database: 0
    
logging:
  level:
    cn.org.bjca.footstone: DEBUG
    org.springframework.web: DEBUG
```

### é…ç½®å±æ€§ç»‘å®šè§„èŒƒ
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * åº”ç”¨é…ç½®å±æ€§ç±»
 * ä½¿ç”¨ @ConfigurationProperties ç»‘å®šé…ç½®
 */
@Data
@Component
@ConfigurationProperties(prefix = "app")
@Validated
public class AppProperties {
    
    /**
     * åº”ç”¨åŸºç¡€é…ç½®
     */
    @NotBlank
    private String name;
    
    @NotBlank
    private String version;
    
    /**
     * ä¸šåŠ¡é…ç½®
     */
    private Business business = new Business();
    
    /**
     * ç¼“å­˜é…ç½®
     */
    private Cache cache = new Cache();
    
    @Data
    public static class Business {
        @Min(1)
        @Max(100)
        private int maxRetryCount = 3;
        
        @NotNull
        private Duration timeout = Duration.ofSeconds(30);
        
        private boolean enableAsync = true;
    }
    
    @Data
    public static class Cache {
        @NotNull
        private Duration defaultTtl = Duration.ofMinutes(30);
        
        @Min(1)
        private int maxSize = 1000;
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ ä¾èµ–æ³¨å…¥è§„èŒƒ

### æ„é€ å™¨æ³¨å…¥ä¼˜å…ˆ
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * âœ… æ¨èï¼šä½¿ç”¨æ„é€ å™¨æ³¨å…¥
 * ä¼˜ç‚¹ï¼šä¸å¯å˜ã€ä¾¿äºæµ‹è¯•ã€é¿å…å¾ªç¯ä¾èµ–
 */
@Service
@RequiredArgsConstructor
@Slf4j
public class UserService {
    
    private final UserMapper userMapper;
    private final RedisTemplate<String, Object> redisTemplate;
    private final AppProperties appProperties;
    
    public User getUserById(Long id) {
        // ç¼“å­˜é”®æ„å»º
        String cacheKey = buildCacheKey("user", id);
        
        // å…ˆæŸ¥ç¼“å­˜
        User user = (User) redisTemplate.opsForValue().get(cacheKey);
        if (user != null) {
            log.debug("User found in cache: {}", id);
            return user;
        }
        
        // æŸ¥æ•°æ®åº“
        user = userMapper.selectById(id);
        if (user != null) {
            // å†™å…¥ç¼“å­˜
            redisTemplate.opsForValue().set(cacheKey, user, 
                appProperties.getCache().getDefaultTtl());
            log.debug("User loaded from database: {}", id);
        }
        
        return user;
    }
    
    private String buildCacheKey(String prefix, Object... keys) {
        return prefix + ":" + String.join(":", 
            Arrays.stream(keys).map(String::valueOf).toArray(String[]::new));
    }
}
// [AI-BLOCK-END]
```

### Beanå®šä¹‰å’Œç”Ÿå‘½å‘¨æœŸ
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * é…ç½®ç±»ç¤ºä¾‹
 */
@Configuration
@EnableScheduling
@EnableAsync
@Slf4j
public class AppConfiguration {
    
    /**
     * Redisé…ç½®
     */
    @Bean
    @Primary
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        
        // ä½¿ç”¨Jacksonåºåˆ—åŒ–
        Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer = 
            new Jackson2JsonRedisSerializer<>(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, 
            ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);
        
        template.setValueSerializer(jackson2JsonRedisSerializer);
        template.setKeySerializer(new StringRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(jackson2JsonRedisSerializer);
        template.afterPropertiesSet();
        
        return template;
    }
    
    /**
     * çº¿ç¨‹æ± é…ç½®
     */
    @Bean(name = "taskExecutor")
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(15);
        executor.setQueueCapacity(100);
        executor.setKeepAliveSeconds(60);
        executor.setThreadNamePrefix("async-task-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(60);
        executor.initialize();
        return executor;
    }
    
    /**
     * ç¼“å­˜ç®¡ç†å™¨
     */
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory factory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new Jackson2JsonRedisSerializer<>(Object.class)));
        
        return RedisCacheManager.builder(factory)
            .cacheDefaults(config)
            .build();
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ æ§åˆ¶å±‚è§„èŒƒ

### RESTful APIè®¾è®¡
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * ç”¨æˆ·ç®¡ç†æ§åˆ¶å™¨
 * RESTful API è®¾è®¡è§„èŒƒ
 */
@RestController
@RequestMapping("/v1/users")
@RequiredArgsConstructor
@Slf4j
@Validated
public class UserController {
    
    private final UserService userService;
    
    /**
     * è·å–ç”¨æˆ·åˆ—è¡¨
     * GET /api/v1/users?page=0&size=20&username=john
     */
    @GetMapping
    public ResponseEntity<PageResult<UserVO>> getUsers(
            @Valid UserQuery query,
            @PageableDefault(size = 20) Pageable pageable) {
        
        log.info("æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨, query: {}, pageable: {}", query, pageable);
        
        PageResult<UserVO> result = userService.findUsers(query, pageable);
        return ResponseEntity.ok(result);
    }
    
    /**
     * æ ¹æ®IDè·å–ç”¨æˆ·
     * GET /api/v1/users/{id}
     */
    @GetMapping("/{id}")
    public ResponseEntity<UserVO> getUserById(
            @PathVariable @Positive Long id) {
        
        log.info("æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…, id: {}", id);
        
        UserVO user = userService.findById(id);
        if (user == null) {
            return ResponseEntity.notFound().build();
        }
        
        return ResponseEntity.ok(user);
    }
    
    /**
     * åˆ›å»ºç”¨æˆ·
     * POST /api/v1/users
     */
    @PostMapping
    public ResponseEntity<UserVO> createUser(
            @Valid @RequestBody CreateUserRequest request,
            HttpServletRequest httpRequest) {
        
        log.info("åˆ›å»ºç”¨æˆ·, request: {}", request);
        
        UserVO user = userService.createUser(request);
        
        // æ„å»ºLocationå¤´
        URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path("/{id}")
            .buildAndExpand(user.getId())
            .toUri();
        
        return ResponseEntity.created(location).body(user);
    }
    
    /**
     * æ›´æ–°ç”¨æˆ·
     * PUT /api/v1/users/{id}
     */
    @PutMapping("/{id}")
    public ResponseEntity<UserVO> updateUser(
            @PathVariable @Positive Long id,
            @Valid @RequestBody UpdateUserRequest request) {
        
        log.info("æ›´æ–°ç”¨æˆ·, id: {}, request: {}", id, request);
        
        UserVO user = userService.updateUser(id, request);
        return ResponseEntity.ok(user);
    }
    
    /**
     * åˆ é™¤ç”¨æˆ·
     * DELETE /api/v1/users/{id}
     */
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable @Positive Long id) {
        log.info("åˆ é™¤ç”¨æˆ·, id: {}", id);
        
        userService.deleteUser(id);
        return ResponseEntity.noContent().build();
    }
}
// [AI-BLOCK-END]
```

### ç»Ÿä¸€å“åº”æ ¼å¼
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * ç»Ÿä¸€å“åº”ç»“æœ
 */
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class ApiResponse<T> {
    
    private int code;
    private String message;
    private T data;
    private long timestamp;
    
    public static <T> ApiResponse<T> success(T data) {
        return ApiResponse.<T>builder()
            .code(200)
            .message("success")
            .data(data)
            .timestamp(System.currentTimeMillis())
            .build();
    }
    
    public static <T> ApiResponse<T> error(int code, String message) {
        return ApiResponse.<T>builder()
            .code(code)
            .message(message)
            .timestamp(System.currentTimeMillis())
            .build();
    }
}

/**
 * åˆ†é¡µç»“æœ
 */
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class PageResult<T> {
    private List<T> content;
    private long totalElements;
    private int totalPages;
    private int size;
    private int number;
    private boolean first;
    private boolean last;
}
// [AI-BLOCK-END]
```

## ğŸ“‹ å¼‚å¸¸å¤„ç†è§„èŒƒ

### å…¨å±€å¼‚å¸¸å¤„ç†å™¨
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 */
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    /**
     * ä¸šåŠ¡å¼‚å¸¸
     */
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ApiResponse<Void>> handleBusinessException(
            BusinessException e, HttpServletRequest request) {
        
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}, URI: {}", e.getMessage(), request.getRequestURI());
        
        ApiResponse<Void> response = ApiResponse.error(e.getCode(), e.getMessage());
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(response);
    }
    
    /**
     * å‚æ•°æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ApiResponse<Map<String, String>>> handleValidationException(
            MethodArgumentNotValidException e) {
        
        Map<String, String> errors = new HashMap<>();
        e.getBindingResult().getFieldErrors().forEach(error -> 
            errors.put(error.getField(), error.getDefaultMessage()));
        
        log.warn("å‚æ•°æ ¡éªŒå¤±è´¥: {}", errors);
        
        ApiResponse<Map<String, String>> response = ApiResponse.<Map<String, String>>builder()
            .code(400)
            .message("å‚æ•°æ ¡éªŒå¤±è´¥")
            .data(errors)
            .timestamp(System.currentTimeMillis())
            .build();
        
        return ResponseEntity.badRequest().body(response);
    }
    
    /**
     * æ•°æ®åº“å¼‚å¸¸
     */
    @ExceptionHandler(DataAccessException.class)
    public ResponseEntity<ApiResponse<Void>> handleDataAccessException(
            DataAccessException e, HttpServletRequest request) {
        
        log.error("æ•°æ®åº“æ“ä½œå¼‚å¸¸: {}, URI: {}", e.getMessage(), request.getRequestURI(), e);
        
        ApiResponse<Void> response = ApiResponse.error(500, "æ•°æ®åº“æ“ä½œå¤±è´¥");
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
    }
    
    /**
     * ç³»ç»Ÿå¼‚å¸¸
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<Void>> handleException(
            Exception e, HttpServletRequest request) {
        
        log.error("ç³»ç»Ÿå¼‚å¸¸: {}, URI: {}", e.getMessage(), request.getRequestURI(), e);
        
        ApiResponse<Void> response = ApiResponse.error(500, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯");
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
    }
}

/**
 * è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class BusinessException extends RuntimeException {
    private final int code;
    
    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
    }
    
    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.code = errorCode.getCode();
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ äº‹åŠ¡ç®¡ç†è§„èŒƒ

### å£°æ˜å¼äº‹åŠ¡ä½¿ç”¨
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * äº‹åŠ¡ä½¿ç”¨ç¤ºä¾‹
 */
@Service
@RequiredArgsConstructor
@Slf4j
@Transactional(readOnly = true)  // é»˜è®¤åªè¯»äº‹åŠ¡
public class OrderService {
    
    private final OrderMapper orderMapper;
    private final ProductService productService;
    private final UserService userService;
    private final NotificationService notificationService;
    
    /**
     * åˆ›å»ºè®¢å• - å†™äº‹åŠ¡
     */
    @Transactional(rollbackFor = Exception.class)
    public Order createOrder(CreateOrderRequest request) {
        log.info("å¼€å§‹åˆ›å»ºè®¢å•: {}", request);
        
        // 1. éªŒè¯ç”¨æˆ·
        User user = userService.findById(request.getUserId());
        if (user == null) {
            throw new BusinessException(ErrorCode.USER_NOT_FOUND);
        }
        
        // 2. éªŒè¯å’Œæ‰£å‡åº“å­˜
        Product product = productService.decreaseStock(
            request.getProductId(), request.getQuantity());
        
        // 3. åˆ›å»ºè®¢å•
        Order order = Order.builder()
            .orderNo(generateOrderNo())
            .userId(request.getUserId())
            .productId(request.getProductId())
            .quantity(request.getQuantity())
            .totalAmount(product.getPrice().multiply(BigDecimal.valueOf(request.getQuantity())))
            .status(OrderStatus.PENDING)
            .build();
        
        orderMapper.insert(order);
        
        // 4. å‘é€é€šçŸ¥ (å¼‚æ­¥ï¼Œä¸å½±å“äº‹åŠ¡)
        notificationService.sendOrderCreatedNotification(order);
        
        log.info("è®¢å•åˆ›å»ºæˆåŠŸ: {}", order.getOrderNo());
        return order;
    }
    
    /**
     * å–æ¶ˆè®¢å• - å†™äº‹åŠ¡ï¼Œè‡ªå®šä¹‰ä¼ æ’­è¡Œä¸º
     */
    @Transactional(
        rollbackFor = Exception.class,
        propagation = Propagation.REQUIRED,
        timeout = 30
    )
    public void cancelOrder(Long orderId, String reason) {
        log.info("å¼€å§‹å–æ¶ˆè®¢å•: {}, åŸå› : {}", orderId, reason);
        
        Order order = orderMapper.selectById(orderId);
        if (order == null) {
            throw new BusinessException(ErrorCode.ORDER_NOT_FOUND);
        }
        
        if (!OrderStatus.PENDING.equals(order.getStatus())) {
            throw new BusinessException(ErrorCode.ORDER_CANNOT_CANCEL);
        }
        
        // 1. æ›´æ–°è®¢å•çŠ¶æ€
        order.setStatus(OrderStatus.CANCELLED);
        order.setCancelReason(reason);
        order.setCancelTime(LocalDateTime.now());
        orderMapper.updateById(order);
        
        // 2. æ¢å¤åº“å­˜
        productService.increaseStock(order.getProductId(), order.getQuantity());
        
        log.info("è®¢å•å–æ¶ˆæˆåŠŸ: {}", orderId);
    }
    
    /**
     * æŸ¥è¯¢è®¢å• - åªè¯»äº‹åŠ¡
     */
    public PageResult<OrderVO> findOrders(OrderQuery query, Pageable pageable) {
        // åªè¯»äº‹åŠ¡ï¼Œä¸ä¼šé”å®šèµ„æº
        return orderMapper.selectByQuery(query, pageable);
    }
    
    private String generateOrderNo() {
        return "ORD" + System.currentTimeMillis() + 
            ThreadLocalRandom.current().nextInt(1000, 9999);
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ AOPç¼–ç¨‹è§„èŒƒ

### åˆ‡é¢å®šä¹‰å’Œä½¿ç”¨
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * æ“ä½œæ—¥å¿—åˆ‡é¢
 */
@Aspect
@Component
@Slf4j
@RequiredArgsConstructor
public class OperationLogAspect {
    
    private final OperationLogService operationLogService;
    
    /**
     * åˆ‡ç‚¹å®šä¹‰
     */
    @Pointcut("@annotation(cn.org.bjca.footstone.annotation.OperationLog)")
    public void operationLogPointcut() {}
    
    /**
     * ç¯ç»•é€šçŸ¥
     */
    @Around("operationLogPointcut()")
    public Object around(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        
        // è·å–æ³¨è§£ä¿¡æ¯
        MethodSignature signature = (MethodSignature) joinPoint.getSignature();
        OperationLog operationLog = signature.getMethod()
            .getAnnotation(OperationLog.class);
        
        // è·å–è¯·æ±‚ä¿¡æ¯
        HttpServletRequest request = getCurrentRequest();
        String userAgent = request.getHeader("User-Agent");
        String ipAddress = getClientIpAddress(request);
        
        // æ„å»ºæ—¥å¿—å¯¹è±¡
        OperationLogEntity logEntity = OperationLogEntity.builder()
            .operation(operationLog.value())
            .method(signature.getMethod().getName())
            .className(signature.getDeclaringType().getSimpleName())
            .requestMethod(request.getMethod())
            .requestUrl(request.getRequestURL().toString())
            .userAgent(userAgent)
            .ipAddress(ipAddress)
            .requestParams(getRequestParams(joinPoint))
            .startTime(LocalDateTime.now())
            .build();
        
        try {
            // æ‰§è¡Œç›®æ ‡æ–¹æ³•
            Object result = joinPoint.proceed();
            
            // è®°å½•æˆåŠŸæ—¥å¿—
            long duration = System.currentTimeMillis() - startTime;
            logEntity.setDuration(duration);
            logEntity.setStatus(OperationStatus.SUCCESS);
            logEntity.setResponse(JsonUtils.toJson(result));
            
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¼‚å¸¸æ—¥å¿—
            long duration = System.currentTimeMillis() - startTime;
            logEntity.setDuration(duration);
            logEntity.setStatus(OperationStatus.FAILED);
            logEntity.setErrorMessage(e.getMessage());
            
            throw e;
        } finally {
            // å¼‚æ­¥ä¿å­˜æ—¥å¿—
            operationLogService.saveAsync(logEntity);
        }
    }
    
    private HttpServletRequest getCurrentRequest() {
        ServletRequestAttributes attributes = 
            (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        return attributes.getRequest();
    }
    
    private String getClientIpAddress(HttpServletRequest request) {
        String xForwardedFor = request.getHeader("X-Forwarded-For");
        if (StringUtils.hasText(xForwardedFor)) {
            return xForwardedFor.split(",")[0].trim();
        }
        
        String xRealIP = request.getHeader("X-Real-IP");
        if (StringUtils.hasText(xRealIP)) {
            return xRealIP;
        }
        
        return request.getRemoteAddr();
    }
    
    private String getRequestParams(ProceedingJoinPoint joinPoint) {
        Object[] args = joinPoint.getArgs();
        if (args.length == 0) {
            return "{}";
        }
        
        // è¿‡æ»¤æ•æ„Ÿå‚æ•°
        List<Object> filteredArgs = Arrays.stream(args)
            .filter(arg -> !(arg instanceof HttpServletRequest) 
                && !(arg instanceof HttpServletResponse))
            .collect(Collectors.toList());
        
        return JsonUtils.toJson(filteredArgs);
    }
}

/**
 * æ“ä½œæ—¥å¿—æ³¨è§£
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface OperationLog {
    /**
     * æ“ä½œæè¿°
     */
    String value();
    
    /**
     * æ˜¯å¦è®°å½•è¯·æ±‚å‚æ•°
     */
    boolean logParams() default true;
    
    /**
     * æ˜¯å¦è®°å½•å“åº”ç»“æœ
     */
    boolean logResult() default true;
}
// [AI-BLOCK-END]
```

## ğŸ“‹ ç¼“å­˜ä½¿ç”¨è§„èŒƒ

### Spring Cacheæ³¨è§£
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * ç¼“å­˜ä½¿ç”¨ç¤ºä¾‹
 */
@Service
@RequiredArgsConstructor
@Slf4j
@CacheConfig(cacheNames = "user")
public class UserCacheService {
    
    private final UserMapper userMapper;
    
    /**
     * ç¼“å­˜æŸ¥è¯¢ç»“æœ
     */
    @Cacheable(
        key = "#id", 
        condition = "#id != null && #id > 0",
        unless = "#result == null"
    )
    public User findById(Long id) {
        log.info("ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·: {}", id);
        return userMapper.selectById(id);
    }
    
    /**
     * ç¼“å­˜å¤æ‚æŸ¥è¯¢
     */
    @Cacheable(
        key = "'list:' + #query.hashCode()",
        condition = "#query != null"
    )
    public List<User> findByQuery(UserQuery query) {
        log.info("ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨: {}", query);
        return userMapper.selectByQuery(query);
    }
    
    /**
     * æ›´æ–°æ—¶æ¸…é™¤ç¼“å­˜
     */
    @CacheEvict(key = "#user.id")
    public User updateUser(User user) {
        log.info("æ›´æ–°ç”¨æˆ·å¹¶æ¸…é™¤ç¼“å­˜: {}", user.getId());
        userMapper.updateById(user);
        return user;
    }
    
    /**
     * åˆ é™¤æ—¶æ¸…é™¤ç¼“å­˜
     */
    @CacheEvict(key = "#id")
    public void deleteUser(Long id) {
        log.info("åˆ é™¤ç”¨æˆ·å¹¶æ¸…é™¤ç¼“å­˜: {}", id);
        userMapper.deleteById(id);
    }
    
    /**
     * æ¸…é™¤æ‰€æœ‰ç¼“å­˜
     */
    @CacheEvict(allEntries = true)
    public void clearAllCache() {
        log.info("æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜");
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ å¼‚æ­¥å¤„ç†è§„èŒƒ

### å¼‚æ­¥æ–¹æ³•ä½¿ç”¨
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * å¼‚æ­¥æœåŠ¡ç¤ºä¾‹
 */
@Service
@RequiredArgsConstructor
@Slf4j
public class NotificationService {
    
    private final EmailService emailService;
    private final SmsService smsService;
    private final MessageProducer messageProducer;
    
    /**
     * å¼‚æ­¥å‘é€é‚®ä»¶
     */
    @Async("taskExecutor")
    public CompletableFuture<Void> sendEmailAsync(String to, String subject, String content) {
        log.info("å¼€å§‹å¼‚æ­¥å‘é€é‚®ä»¶: to={}, subject={}", to, subject);
        
        try {
            emailService.send(to, subject, content);
            log.info("é‚®ä»¶å‘é€æˆåŠŸ: {}", to);
        } catch (Exception e) {
            log.error("é‚®ä»¶å‘é€å¤±è´¥: {}", to, e);
            throw e;
        }
        
        return CompletableFuture.completedFuture(null);
    }
    
    /**
     * å¼‚æ­¥å‘é€çŸ­ä¿¡
     */
    @Async("taskExecutor")
    public CompletableFuture<Boolean> sendSmsAsync(String phone, String message) {
        log.info("å¼€å§‹å¼‚æ­¥å‘é€çŸ­ä¿¡: phone={}", phone);
        
        try {
            boolean success = smsService.send(phone, message);
            log.info("çŸ­ä¿¡å‘é€{}: {}", success ? "æˆåŠŸ" : "å¤±è´¥", phone);
            return CompletableFuture.completedFuture(success);
        } catch (Exception e) {
            log.error("çŸ­ä¿¡å‘é€å¼‚å¸¸: {}", phone, e);
            return CompletableFuture.completedFuture(false);
        }
    }
    
    /**
     * ç»„åˆå¼‚æ­¥æ“ä½œ
     */
    public void sendOrderNotification(Order order) {
        User user = getUserById(order.getUserId());
        
        // ç»„åˆå¤šä¸ªå¼‚æ­¥æ“ä½œ
        CompletableFuture<Void> emailFuture = sendEmailAsync(
            user.getEmail(),
            "è®¢å•åˆ›å»ºæˆåŠŸ",
            buildOrderEmailContent(order)
        );
        
        CompletableFuture<Boolean> smsFuture = sendSmsAsync(
            user.getPhone(),
            buildOrderSmsContent(order)
        );
        
        // ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆ
        CompletableFuture.allOf(emailFuture, smsFuture)
            .thenRun(() -> log.info("è®¢å•é€šçŸ¥å‘é€å®Œæˆ: {}", order.getOrderNo()))
            .exceptionally(throwable -> {
                log.error("è®¢å•é€šçŸ¥å‘é€å¤±è´¥: {}", order.getOrderNo(), throwable);
                return null;
            });
    }
    
    /**
     * å¼‚æ­¥å¤„ç†ä¸šåŠ¡é€»è¾‘
     */
    @Async("taskExecutor")
    @Retryable(
        value = {Exception.class},
        maxAttempts = 3,
        backoff = @Backoff(delay = 1000, multiplier = 2)
    )
    public CompletableFuture<Void> processOrderAsync(Long orderId) {
        log.info("å¼€å§‹å¼‚æ­¥å¤„ç†è®¢å•: {}", orderId);
        
        try {
            // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
            Thread.sleep(5000);
            
            // å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—
            messageProducer.sendOrderProcessedMessage(orderId);
            
            log.info("è®¢å•å¤„ç†å®Œæˆ: {}", orderId);
            return CompletableFuture.completedFuture(null);
        } catch (Exception e) {
            log.error("è®¢å•å¤„ç†å¤±è´¥: {}", orderId, e);
            throw new RuntimeException("è®¢å•å¤„ç†å¤±è´¥", e);
        }
    }
    
    @Recover
    public CompletableFuture<Void> recover(Exception e, Long orderId) {
        log.error("è®¢å•å¤„ç†æœ€ç»ˆå¤±è´¥ï¼Œè¿›å…¥æ¢å¤é€»è¾‘: {}", orderId, e);
        // å‘é€å¤±è´¥é€šçŸ¥æˆ–è®°å½•å¤±è´¥æ—¥å¿—
        return CompletableFuture.completedFuture(null);
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ æ•°æ®æ ¡éªŒè§„èŒƒ

### Bean Validationä½¿ç”¨
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * ç”¨æˆ·åˆ›å»ºè¯·æ±‚DTO
 */
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class CreateUserRequest {
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 50, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-50ä¸ªå­—ç¬¦ä¹‹é—´")
    @Pattern(regexp = "^[a-zA-Z0-9_]+$", message = "ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿")
    private String username;
    
    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 8, max = 20, message = "å¯†ç é•¿åº¦å¿…é¡»åœ¨8-20ä¸ªå­—ç¬¦ä¹‹é—´")
    @Pattern(
        regexp = "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]+$",
        message = "å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦"
    )
    private String password;
    
    @Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18å²")
    @Max(value = 120, message = "å¹´é¾„ä¸èƒ½å¤§äº120å²")
    private Integer age;
    
    @Valid
    @NotNull(message = "åœ°å€ä¿¡æ¯ä¸èƒ½ä¸ºç©º")
    private AddressDTO address;
    
    @NotEmpty(message = "è§’è‰²åˆ—è¡¨ä¸èƒ½ä¸ºç©º")
    private List<@NotBlank(message = "è§’è‰²ä¸èƒ½ä¸ºç©º") String> roles;
}

/**
 * åœ°å€DTO
 */
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class AddressDTO {
    
    @NotBlank(message = "çœä»½ä¸èƒ½ä¸ºç©º")
    private String province;
    
    @NotBlank(message = "åŸå¸‚ä¸èƒ½ä¸ºç©º")
    private String city;
    
    @NotBlank(message = "è¯¦ç»†åœ°å€ä¸èƒ½ä¸ºç©º")
    @Size(max = 200, message = "è¯¦ç»†åœ°å€ä¸èƒ½è¶…è¿‡200ä¸ªå­—ç¬¦")
    private String detail;
    
    @Pattern(regexp = "^\\d{6}$", message = "é‚®æ”¿ç¼–ç æ ¼å¼ä¸æ­£ç¡®")
    private String zipCode;
}

/**
 * è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£
 */
@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = UniqueUsernameValidator.class)
@Documented
public @interface UniqueUsername {
    String message() default "ç”¨æˆ·åå·²å­˜åœ¨";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

/**
 * è‡ªå®šä¹‰æ ¡éªŒå™¨
 */
@Component
@RequiredArgsConstructor
public class UniqueUsernameValidator implements ConstraintValidator<UniqueUsername, String> {
    
    private final UserService userService;
    
    @Override
    public boolean isValid(String username, ConstraintValidatorContext context) {
        if (username == null || username.trim().isEmpty()) {
            return true; // ç©ºå€¼äº¤ç”±@NotBlankå¤„ç†
        }
        
        return !userService.existsByUsername(username);
    }
}
// [AI-BLOCK-END]
```

## ğŸ“‹ ç›‘æ§å’Œå¥åº·æ£€æŸ¥

### Actuatoré…ç½®
```java
// [AI-BLOCK-START] - ç”Ÿæˆå·¥å…·: Claude 3.5 Sonnet
/**
 * è‡ªå®šä¹‰å¥åº·æ£€æŸ¥
 */
@Component
@RequiredArgsConstructor
@Slf4j
public class DatabaseHealthIndicator implements HealthIndicator {
    
    private final UserMapper userMapper;
    
    @Override
    public Health health() {
        try {
            // æ‰§è¡Œç®€å•æŸ¥è¯¢æµ‹è¯•æ•°æ®åº“è¿æ¥
            int count = userMapper.selectCount(null);
            
            return Health.up()
                .withDetail("database", "available")
                .withDetail("userCount", count)
                .withDetail("timestamp", LocalDateTime.now())
                .build();
                
        } catch (Exception e) {
            log.error("æ•°æ®åº“å¥åº·æ£€æŸ¥å¤±è´¥", e);
            
            return Health.down()
                .withDetail("database", "unavailable")
                .withDetail("error", e.getMessage())
                .withDetail("timestamp", LocalDateTime.now())
                .build();
        }
    }
}

/**
 * è‡ªå®šä¹‰ä¿¡æ¯ç«¯ç‚¹
 */
@Component
public class AppInfoContributor implements InfoContributor {
    
    @Override
    public void contribute(Info.Builder builder) {
        builder.withDetail("app", Map.of(
            "name", "footstone-demo",
            "version", "1.0.0",
            "description", "Spring Boot ç¤ºä¾‹åº”ç”¨"
        ));
        
        builder.withDetail("build", Map.of(
            "time", LocalDateTime.now().toString(),
            "jdk", System.getProperty("java.version"),
            "os", System.getProperty("os.name")
        ));
    }
}

/**
 * è‡ªå®šä¹‰æŒ‡æ ‡
 */
@Component
@RequiredArgsConstructor
public class CustomMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter userCreatedCounter;
    private final Timer orderProcessingTimer;
    
    public CustomMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.userCreatedCounter = Counter.builder("user.created")
            .description("ç”¨æˆ·åˆ›å»ºæ•°é‡")
            .register(meterRegistry);
        this.orderProcessingTimer = Timer.builder("order.processing.time")
            .description("è®¢å•å¤„ç†æ—¶é—´")
            .register(meterRegistry);
    }
    
    public void incrementUserCreated() {
        userCreatedCounter.increment();
    }
    
    public void recordOrderProcessingTime(Duration duration) {
        orderProcessingTimer.record(duration);
    }
    
    @EventListener
    public void handleUserCreatedEvent(UserCreatedEvent event) {
        incrementUserCreated();
        
        // è®°å½•ç”¨æˆ·åˆ›å»ºæ—¶çš„å…¶ä»–æŒ‡æ ‡
        Gauge.builder("user.total")
            .description("ç”¨æˆ·æ€»æ•°")
            .register(meterRegistry, this, CustomMetrics::getUserCount);
    }
    
    private double getUserCount() {
        // è¿”å›å½“å‰ç”¨æˆ·æ€»æ•°
        return 0.0;
    }
}
// [AI-BLOCK-END]
```

## âœ… æ£€æŸ¥æ¸…å•

### å¼€å‘é˜¶æ®µæ£€æŸ¥
- [ ] ä½¿ç”¨@ConfigurationPropertiesç»‘å®šé…ç½®
- [ ] ä¼˜å…ˆä½¿ç”¨æ„é€ å™¨æ³¨å…¥
- [ ] æ§åˆ¶å™¨ä½¿ç”¨RESTfulè®¾è®¡
- [ ] å¼‚å¸¸å¤„ç†ä½¿ç”¨@ControllerAdvice
- [ ] äº‹åŠ¡æ³¨è§£æ­£ç¡®é…ç½®ä¼ æ’­è¡Œä¸ºå’Œå›æ»šæ¡ä»¶

### æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥
- [ ] åˆç†ä½¿ç”¨ç¼“å­˜æ³¨è§£
- [ ] å¼‚æ­¥æ–¹æ³•ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± 
- [ ] å¤§æ•°æ®é‡æ“ä½œè€ƒè™‘åˆ†é¡µå¤„ç†
- [ ] æ•°æ®åº“è¿æ¥æ± é…ç½®åˆç†
- [ ] Redisè¿æ¥æ± é…ç½®ä¼˜åŒ–

### å®‰å…¨æ£€æŸ¥
- [ ] æ•æ„Ÿé…ç½®ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] è¾“å…¥å‚æ•°è¿›è¡Œæ ¡éªŒ
- [ ] è¾“å‡ºç»“æœè¿›è¡Œè„±æ•
- [ ] ä½¿ç”¨HTTPSä¼ è¾“
- [ ] æ—¥å¿—ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯

### ç›‘æ§æ£€æŸ¥
- [ ] é…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡ç›‘æ§
- [ ] æ—¥å¿—çº§åˆ«é…ç½®åˆç†
- [ ] å¼‚å¸¸ä¿¡æ¯è®°å½•å®Œæ•´
- [ ] æ€§èƒ½æŒ‡æ ‡æ”¶é›†å®Œå–„

---
*éµå¾ªä»¥ä¸ŠSpring Bootè§„èŒƒï¼Œæ„å»ºé«˜è´¨é‡çš„ä¼ä¸šçº§åº”ç”¨*
description:
globs:
alwaysApply: false
---
