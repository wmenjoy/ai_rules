# 4.2 ä»£ç ç»“æ„å’Œç»„ç»‡æ£€æŸ¥

## 4.2.1 ä»£ç è§„èŒƒæ£€æŸ¥ ğŸŸ¡

### 4.2.1.1 æ³¨é‡Šå®Œæ•´æ€§æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. å…³é”®ä¸šåŠ¡é€»è¾‘æ˜¯å¦æœ‰æ¸…æ™°æ³¨é‡Šã€‚
b. è¾¹ç•Œå¤„ç†å’Œå¼‚å¸¸æƒ…å†µæ˜¯å¦æœ‰è¯´æ˜ã€‚
c. å¤æ‚ç®—æ³•å’Œè®¡ç®—é€»è¾‘æ˜¯å¦æœ‰æ³¨é‡Šã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. SonarQubeï¼ˆæ£€æµ‹æ³¨é‡Šè¦†ç›–ç‡ï¼‰ã€‚
2. äººå·¥ä»£ç å®¡æŸ¥ã€‚
3. æ³¨é‡Šè´¨é‡æ£€æŸ¥å·¥å…·ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šç¼ºå°‘å…³é”®é€»è¾‘æ³¨é‡Š
public class OrderProcessor {
    public void processOrder(Order order) {
        if (order.getAmount().compareTo(new BigDecimal("1000")) > 0) {
            // æ²¡æœ‰è¯´æ˜ä¸ºä»€ä¹ˆ1000æ˜¯é˜ˆå€¼
            order.setStatus("REVIEW_REQUIRED");
        }
        
        // å¤æ‚çš„æŠ˜æ‰£è®¡ç®—é€»è¾‘ï¼Œæ²¡æœ‰æ³¨é‡Š
        BigDecimal discount = order.getAmount()
            .multiply(new BigDecimal("0.1"))
            .add(order.getItems().size() > 5 ? new BigDecimal("50") : BigDecimal.ZERO)
            .min(order.getAmount().multiply(new BigDecimal("0.3")));
    }
}

// âŒ é”™è¯¯ï¼šè¾¹ç•Œå¤„ç†æ— æ³¨é‡Š
public String formatPhoneNumber(String phone) {
    if (phone == null || phone.length() < 10) {
        return phone; // æ²¡æœ‰è¯´æ˜ä¸ºä»€ä¹ˆå°äº10ä½ç›´æ¥è¿”å›
    }
    return phone.substring(0, 3) + "-" + phone.substring(3, 6) + "-" + phone.substring(6);
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„æ³¨é‡Šè¯´æ˜
public class OrderProcessor {
    /**
     * å¤„ç†è®¢å•
     * ä¸šåŠ¡è§„åˆ™ï¼š
     * 1. è®¢å•é‡‘é¢è¶…è¿‡1000å…ƒéœ€è¦äººå·¥å®¡æ ¸
     * 2. æŠ˜æ‰£è®¡ç®—ï¼šåŸºç¡€10% + è¶…è¿‡5ä»¶å•†å“é¢å¤–50å…ƒ + æœ€é«˜ä¸è¶…è¿‡30%
     */
    public void processOrder(Order order) {
        // å¤§é¢è®¢å•éœ€è¦äººå·¥å®¡æ ¸ï¼Œé˜²æ­¢æ¬ºè¯ˆé£é™©
        if (order.getAmount().compareTo(new BigDecimal("1000")) > 0) {
            order.setStatus("REVIEW_REQUIRED");
        }
        
        // è®¡ç®—è®¢å•æŠ˜æ‰£ï¼šåŸºç¡€10% + å¤šä»¶å•†å“å¥–åŠ± + ä¸Šé™æ§åˆ¶
        BigDecimal baseDiscount = order.getAmount().multiply(new BigDecimal("0.1"));
        BigDecimal bulkBonus = order.getItems().size() > 5 ? new BigDecimal("50") : BigDecimal.ZERO;
        BigDecimal maxDiscount = order.getAmount().multiply(new BigDecimal("0.3"));
        
        BigDecimal finalDiscount = baseDiscount.add(bulkBonus).min(maxDiscount);
    }
}

// âœ… æ­£ç¡®ï¼šè¾¹ç•Œå¤„ç†æœ‰æ¸…æ™°è¯´æ˜
/**
 * æ ¼å¼åŒ–ç”µè¯å·ç ä¸º XXX-XXX-XXXX æ ¼å¼
 * @param phone åŸå§‹ç”µè¯å·ç 
 * @return æ ¼å¼åŒ–åçš„ç”µè¯å·ç ï¼Œå¦‚æœè¾“å…¥æ— æ•ˆåˆ™è¿”å›åŸå€¼
 */
public String formatPhoneNumber(String phone) {
    // è¾“å…¥éªŒè¯ï¼šnullæˆ–é•¿åº¦ä¸è¶³10ä½çš„å·ç è§†ä¸ºæ— æ•ˆï¼Œç›´æ¥è¿”å›
    if (phone == null || phone.length() < 10) {
        return phone;
    }
    
    // æ ‡å‡†ç¾å›½ç”µè¯å·ç æ ¼å¼åŒ–ï¼šå‰3ä½-ä¸­é—´3ä½-å4ä½
    return phone.substring(0, 3) + "-" + phone.substring(3, 6) + "-" + phone.substring(6);
}
```

### 4.2.1.2 ä»£ç åˆ†å±‚ç»“æ„æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. ä»£ç ç»“æ„å±‚æ¬¡æ˜¯å¦æ¸…æ™°ã€‚
b. å•ä¸ªæ–‡ä»¶èŒè´£æ˜¯å¦å•ä¸€ã€‚
c. åŒ…ç»“æ„æ˜¯å¦åˆç†ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. æ¶æ„æ‰«æå·¥å…·ï¼ˆå¦‚ArchUnitï¼‰ã€‚
2. åŒ…ä¾èµ–å…³ç³»åˆ†æã€‚
3. ç±»èŒè´£åˆ†æã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šå•ä¸ªç±»æ‰¿æ‹…å¤šä¸ªèŒè´£
public class UserController {
    // æ§åˆ¶å™¨èŒè´£
    @PostMapping("/users")
    public ResponseEntity<User> createUser(@RequestBody CreateUserRequest request) {
        // âŒ ç›´æ¥åœ¨Controllerä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘
        User user = new User();
        user.setName(request.getName());
        user.setEmail(request.getEmail());
        
        // âŒ ç›´æ¥åœ¨Controllerä¸­å¤„ç†æ•°æ®åº“æ“ä½œ
        Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/db");
        PreparedStatement stmt = conn.prepareStatement("INSERT INTO users...");
        stmt.setString(1, user.getName());
        stmt.executeUpdate();
        
        // âŒ ç›´æ¥åœ¨Controllerä¸­å¤„ç†é‚®ä»¶å‘é€
        EmailSender.send(user.getEmail(), "Welcome!");
        
        return ResponseEntity.ok(user);
    }
}

// âŒ é”™è¯¯ï¼šåŒ…ç»“æ„æ··ä¹±
// com.example.controller.UserService.java
// com.example.service.UserController.java
// com.example.model.UserRepository.java
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šæ¸…æ™°çš„åˆ†å±‚ç»“æ„

// Controllerå±‚ï¼šåªè´Ÿè´£HTTPè¯·æ±‚å¤„ç†
@RestController
@RequestMapping("/api/users")
public class UserController {
    private final UserService userService;
    
    @PostMapping
    public ResponseEntity<UserResponse> createUser(@RequestBody CreateUserRequest request) {
        User user = userService.createUser(request);
        return ResponseEntity.ok(UserResponse.from(user));
    }
}

// Serviceå±‚ï¼šè´Ÿè´£ä¸šåŠ¡é€»è¾‘
@Service
public class UserService {
    private final UserRepository userRepository;
    private final EmailService emailService;
    
    @Transactional
    public User createUser(CreateUserRequest request) {
        User user = User.builder()
            .name(request.getName())
            .email(request.getEmail())
            .build();
            
        User savedUser = userRepository.save(user);
        emailService.sendWelcomeEmail(savedUser);
        
        return savedUser;
    }
}

// Repositoryå±‚ï¼šè´Ÿè´£æ•°æ®è®¿é—®
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByEmail(String email);
}

// æ­£ç¡®çš„åŒ…ç»“æ„ï¼š
// com.example.controller.UserController
// com.example.service.UserService
// com.example.repository.UserRepository
// com.example.model.User
// com.example.dto.CreateUserRequest
// com.example.dto.UserResponse
```

### 4.2.1.3 ç¡¬ç¼–ç æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. æ˜¯å¦å­˜åœ¨é­”æ³•æ•°å­—å’Œå­—ç¬¦ä¸²ã€‚
b. é…ç½®ä¿¡æ¯æ˜¯å¦å¤–éƒ¨åŒ–ã€‚
c. å¸¸é‡æ˜¯å¦ç»Ÿä¸€ç®¡ç†ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. SonarQubeè§„åˆ™æ£€æµ‹ã€‚
2. é™æ€ä»£ç åˆ†æå·¥å…·ã€‚
3. äººå·¥ä»£ç å®¡æŸ¥ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç é­”æ³•æ•°å­—å’Œå­—ç¬¦ä¸²
public class OrderService {
    public void processOrder(Order order) {
        // âŒ é­”æ³•æ•°å­—
        if (order.getAmount().compareTo(new BigDecimal("1000")) > 0) {
            order.setStatus("PENDING_REVIEW");
        }
        
        // âŒ ç¡¬ç¼–ç URL
        String apiUrl = "https://api.payment.com/v1/charge";
        
        // âŒ ç¡¬ç¼–ç é…ç½®
        int maxRetries = 3;
        int timeoutMs = 5000;
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å¸¸é‡å’Œé…ç½®
public class OrderConstants {
    public static final BigDecimal REVIEW_THRESHOLD = new BigDecimal("1000");
    public static final String STATUS_PENDING_REVIEW = "PENDING_REVIEW";
}

@Component
@ConfigurationProperties(prefix = "payment")
public class PaymentConfig {
    private String apiUrl;
    private int maxRetries = 3;
    private int timeoutMs = 5000;
    
    // getters and setters
}

@Service
public class OrderService {
    private final PaymentConfig paymentConfig;
    
    public void processOrder(Order order) {
        // ä½¿ç”¨å¸¸é‡
        if (order.getAmount().compareTo(OrderConstants.REVIEW_THRESHOLD) > 0) {
            order.setStatus(OrderConstants.STATUS_PENDING_REVIEW);
        }
        
        // ä½¿ç”¨é…ç½®
        String apiUrl = paymentConfig.getApiUrl();
        int maxRetries = paymentConfig.getMaxRetries();
    }
}
```

### 4.2.1.4 ä»£ç æ ¼å¼åŒ–å·¥å…·æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. æ˜¯å¦ä½¿ç”¨ç»Ÿä¸€çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚
b. ä»£ç é£æ ¼æ˜¯å¦ä¸€è‡´ã€‚
c. æ˜¯å¦æœ‰è‡ªåŠ¨åŒ–æ ¼å¼æ£€æŸ¥ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. æ£€æŸ¥é¡¹ç›®é…ç½®æ–‡ä»¶ï¼ˆ.editorconfigã€checkstyle.xmlç­‰ï¼‰ã€‚
2. CI/CDæµæ°´çº¿ä¸­çš„æ ¼å¼æ£€æŸ¥ã€‚
3. IDEé…ç½®æ£€æŸ¥ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šä¸ä¸€è‡´çš„ä»£ç é£æ ¼
public class UserService{
    private UserRepository userRepository;
    
    public User createUser(String name,String email) {
        if(name==null||email==null){
            throw new IllegalArgumentException("å‚æ•°ä¸èƒ½ä¸ºç©º");
        }
        User user=new User();
        user.setName(name);user.setEmail(email);
        return userRepository.save(user);
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šç»Ÿä¸€çš„ä»£ç æ ¼å¼
public class UserService {
    private final UserRepository userRepository;
    
    public User createUser(String name, String email) {
        if (name == null || email == null) {
            throw new IllegalArgumentException("å‚æ•°ä¸èƒ½ä¸ºç©º");
        }
        
        User user = new User();
        user.setName(name);
        user.setEmail(email);
        
        return userRepository.save(user);
    }
}

// é¡¹ç›®é…ç½®æ–‡ä»¶ç¤ºä¾‹
// checkstyle.xml
<?xml version="1.0"?>
<!DOCTYPE module PUBLIC "-//Checkstyle//DTD Checkstyle Configuration 1.3//EN"
    "https://checkstyle.org/dtds/configuration_1_3.dtd">
<module name="Checker">
    <module name="TreeWalker">
        <module name="Indentation">
            <property name="basicOffset" value="4"/>
        </module>
        <module name="WhitespaceAround"/>
        <module name="LeftCurly"/>
    </module>
</module>
```

## 4.2.2 æ¨¡å—åŒ–ä¸ä¾èµ–ç®¡ç†æ£€æŸ¥ ğŸ”´

### 4.2.2.1 ä»£ç æ¨¡å—å’Œç±»çš„åˆ’åˆ†æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. æ¨¡å—è¾¹ç•Œæ˜¯å¦æ¸…æ™°ã€‚
b. èŒè´£åˆ’åˆ†æ˜¯å¦åˆç†ã€‚
c. è€¦åˆåº¦æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´å†…ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. æ¶æ„åˆ†æå·¥å…·ï¼ˆå¦‚ArchUnitã€JDependï¼‰ã€‚
2. ä¾èµ–å…³ç³»å›¾åˆ†æã€‚
3. åœˆå¤æ‚åº¦æ£€æµ‹ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šæ¨¡å—èŒè´£ä¸æ¸…ï¼Œé«˜è€¦åˆ
public class UserOrderService {
    // âŒ ä¸€ä¸ªç±»å¤„ç†ç”¨æˆ·å’Œè®¢å•ä¸¤ä¸ªä¸åŒé¢†åŸŸ
    public void createUser(String name, String email) {
        // ç”¨æˆ·åˆ›å»ºé€»è¾‘
    }
    
    public void createOrder(Long userId, List<Item> items) {
        // è®¢å•åˆ›å»ºé€»è¾‘
    }
    
    public void sendUserNotification(Long userId, String message) {
        // é€šçŸ¥é€»è¾‘
    }
    
    public void calculateOrderDiscount(Order order) {
        // æŠ˜æ‰£è®¡ç®—é€»è¾‘
    }
}

// âŒ é”™è¯¯ï¼šç›´æ¥ä¾èµ–å…·ä½“å®ç°
public class OrderService {
    private MySQLOrderRepository orderRepository; // ç›´æ¥ä¾èµ–MySQLå®ç°
    private SMTPEmailSender emailSender; // ç›´æ¥ä¾èµ–SMTPå®ç°
    
    public void processOrder(Order order) {
        orderRepository.save(order);
        emailSender.sendConfirmation(order.getCustomerEmail());
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šæ¸…æ™°çš„æ¨¡å—åˆ’åˆ†

// ç”¨æˆ·æ¨¡å—
@Service
public class UserService {
    private final UserRepository userRepository;
    
    public User createUser(CreateUserRequest request) {
        // åªè´Ÿè´£ç”¨æˆ·ç›¸å…³é€»è¾‘
    }
}

// è®¢å•æ¨¡å—
@Service
public class OrderService {
    private final OrderRepository orderRepository;
    private final NotificationService notificationService;
    
    public Order createOrder(CreateOrderRequest request) {
        // åªè´Ÿè´£è®¢å•ç›¸å…³é€»è¾‘
    }
}

// é€šçŸ¥æ¨¡å—
@Service
public class NotificationService {
    private final EmailSender emailSender;
    
    public void sendOrderConfirmation(Order order) {
        // åªè´Ÿè´£é€šçŸ¥ç›¸å…³é€»è¾‘
    }
}

// âœ… æ­£ç¡®ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
@Service
public class OrderService {
    private final OrderRepository orderRepository; // ä¾èµ–æ¥å£
    private final EmailSender emailSender; // ä¾èµ–æ¥å£
    
    public void processOrder(Order order) {
        orderRepository.save(order);
        emailSender.sendConfirmation(order.getCustomerEmail());
    }
}

// æ¥å£å®šä¹‰
public interface OrderRepository {
    Order save(Order order);
}

public interface EmailSender {
    void sendConfirmation(String email);
}
```

### 4.2.2.2 æ¥å£å’ŒæŠ½è±¡ç±»ä½¿ç”¨æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. æ¥å£æŠ½è±¡æ˜¯å¦åˆç†ã€‚
b. æŠ½è±¡ç±»ä½¿ç”¨æ˜¯å¦æ°å½“ã€‚
c. æ˜¯å¦éµå¾ªæ¥å£éš”ç¦»åŸåˆ™ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. æ¥å£è®¾è®¡å®¡æŸ¥ã€‚
2. æŠ½è±¡å±‚æ¬¡åˆ†æã€‚
3. ä¾èµ–å€’ç½®åŸåˆ™æ£€æŸ¥ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šæ¥å£è¿‡äºåºå¤§ï¼Œè¿åæ¥å£éš”ç¦»åŸåˆ™
public interface UserService {
    // ç”¨æˆ·ç®¡ç†
    User createUser(CreateUserRequest request);
    User updateUser(UpdateUserRequest request);
    void deleteUser(Long userId);
    
    // ç”¨æˆ·è®¤è¯
    boolean authenticate(String username, String password);
    String generateToken(User user);
    
    // ç”¨æˆ·ç»Ÿè®¡
    UserStatistics getUserStatistics(Long userId);
    List<UserReport> generateUserReports();
    
    // ç”¨æˆ·é€šçŸ¥
    void sendWelcomeEmail(User user);
    void sendPasswordResetEmail(String email);
}

// âŒ é”™è¯¯ï¼šä¸å¿…è¦çš„æŠ½è±¡ç±»
public abstract class BaseEntity {
    private Long id;
    private Date createdAt;
    
    // åªæœ‰ç®€å•çš„getter/setterï¼Œä¸éœ€è¦æŠ½è±¡ç±»
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šèŒè´£å•ä¸€çš„æ¥å£
public interface UserManagementService {
    User createUser(CreateUserRequest request);
    User updateUser(UpdateUserRequest request);
    void deleteUser(Long userId);
}

public interface UserAuthenticationService {
    boolean authenticate(String username, String password);
    String generateToken(User user);
}

public interface UserNotificationService {
    void sendWelcomeEmail(User user);
    void sendPasswordResetEmail(String email);
}

// âœ… æ­£ç¡®ï¼šæœ‰æ„ä¹‰çš„æŠ½è±¡ç±»
public abstract class PaymentProcessor {
    // æ¨¡æ¿æ–¹æ³•æ¨¡å¼
    public final PaymentResult processPayment(PaymentRequest request) {
        validateRequest(request);
        PaymentResult result = doProcessPayment(request);
        logPaymentResult(result);
        return result;
    }
    
    protected void validateRequest(PaymentRequest request) {
        // é€šç”¨éªŒè¯é€»è¾‘
    }
    
    protected abstract PaymentResult doProcessPayment(PaymentRequest request);
    
    protected void logPaymentResult(PaymentResult result) {
        // é€šç”¨æ—¥å¿—é€»è¾‘
    }
}
```

### 4.2.2.3 ç¬¬ä¸‰æ–¹ç»„ä»¶ç®¡ç†æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. ç¬¬ä¸‰æ–¹ä¾èµ–æ˜¯å¦ç»è¿‡å®‰å…¨å®¡æ ¸ã€‚
b. ç‰ˆæœ¬å†²çªæ˜¯å¦è§£å†³ã€‚
c. è®¸å¯è¯æ˜¯å¦åˆè§„ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. ä¾èµ–æ‰«æå·¥å…·ï¼ˆå¦‚OWASP Dependency Checkï¼‰ã€‚
2. è®¸å¯è¯åˆè§„æ£€æŸ¥ã€‚
3. ç‰ˆæœ¬å†²çªåˆ†æã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```xml
<!-- âŒ é”™è¯¯ï¼šä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„ç‰ˆæœ¬ -->
<dependency>
    <groupId>org.apache.struts</groupId>
    <artifactId>struts2-core</artifactId>
    <version>2.3.16</version> <!-- å·²çŸ¥å®‰å…¨æ¼æ´ -->
</dependency>

<!-- âŒ é”™è¯¯ï¼šç‰ˆæœ¬å†²çª -->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-core</artifactId>
    <version>2.9.8</version>
</dependency>
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.10.1</version> <!-- ç‰ˆæœ¬ä¸ä¸€è‡´ -->
</dependency>

<!-- âŒ é”™è¯¯ï¼šå¼•å…¥ä¸å¿…è¦çš„å¤§å‹ä¾èµ– -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context</artifactId>
    <version>5.3.21</version>
</dependency>
<!-- åªæ˜¯ä¸ºäº†ä½¿ç”¨ä¸€ä¸ªå·¥å…·ç±»å°±å¼•å…¥æ•´ä¸ªSpringæ¡†æ¶ -->
```

**4. æ­£ç¡®ç¤ºä¾‹**

```xml
<!-- âœ… æ­£ç¡®ï¼šä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ -->
<dependency>
    <groupId>org.apache.struts</groupId>
    <artifactId>struts2-core</artifactId>
    <version>2.5.30</version> <!-- æœ€æ–°ç¨³å®šç‰ˆæœ¬ -->
</dependency>

<!-- âœ… æ­£ç¡®ï¼šç»Ÿä¸€ç‰ˆæœ¬ç®¡ç† -->
<properties>
    <jackson.version>2.13.3</jackson.version>
</properties>

<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-core</artifactId>
    <version>${jackson.version}</version>
</dependency>
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>${jackson.version}</version>
</dependency>

<!-- âœ… æ­£ç¡®ï¼šæœ€å°åŒ–ä¾èµ– -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.12.0</version>
</dependency>
<!-- ä½¿ç”¨è½»é‡çº§å·¥å…·åº“è€Œä¸æ˜¯é‡å‹æ¡†æ¶ -->
```

## 4.2.3 æ¶æ„è®¾è®¡æ£€æŸ¥ ğŸŸ¡

### 4.2.3.1 è®¾è®¡æ¨¡å¼æ°å½“æ€§æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. è®¾è®¡æ¨¡å¼ä½¿ç”¨æ˜¯å¦æ°å½“ã€‚
b. æ˜¯å¦å­˜åœ¨è¿‡åº¦è®¾è®¡ã€‚
c. æ˜¯å¦éµå¾ªSOLIDåŸåˆ™ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. æ¶æ„è¯„å®¡ã€‚
2. è®¾è®¡æ¨¡å¼ä½¿ç”¨åˆ†æã€‚
3. ä»£ç å¤æ‚åº¦è¯„ä¼°ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šè¿‡åº¦è®¾è®¡ï¼Œç®€å•åŠŸèƒ½ä½¿ç”¨å¤æ‚æ¨¡å¼
public class SimpleCalculatorFactory {
    public static Calculator createCalculator(String type) {
        switch (type) {
            case "basic":
                return new BasicCalculator();
            default:
                throw new IllegalArgumentException("Unknown calculator type");
        }
    }
}

public interface Calculator {
    double add(double a, double b);
    double subtract(double a, double b);
}

public class BasicCalculator implements Calculator {
    public double add(double a, double b) {
        return a + b;
    }
    
    public double subtract(double a, double b) {
        return a - b;
    }
}

// ä½¿ç”¨æ–¹å¼è¿‡äºå¤æ‚
Calculator calc = SimpleCalculatorFactory.createCalculator("basic");
double result = calc.add(1, 2);

// âŒ é”™è¯¯ï¼šä¸å¿…è¦çš„å•ä¾‹æ¨¡å¼
public class ConfigurationManager {
    private static ConfigurationManager instance;
    private Properties properties;
    
    private ConfigurationManager() {
        properties = new Properties();
    }
    
    public static synchronized ConfigurationManager getInstance() {
        if (instance == null) {
            instance = new ConfigurationManager();
        }
        return instance;
    }
    
    public String getProperty(String key) {
        return properties.getProperty(key);
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šç®€å•åŠŸèƒ½ç”¨ç®€å•å®ç°
public class Calculator {
    public double add(double a, double b) {
        return a + b;
    }
    
    public double subtract(double a, double b) {
        return a - b;
    }
}

// ç›´æ¥ä½¿ç”¨ï¼Œç®€å•æ˜äº†
Calculator calc = new Calculator();
double result = calc.add(1, 2);

// âœ… æ­£ç¡®ï¼šåˆç†ä½¿ç”¨è®¾è®¡æ¨¡å¼
// ç­–ç•¥æ¨¡å¼ç”¨äºå¤æ‚çš„æŠ˜æ‰£è®¡ç®—
public interface DiscountStrategy {
    BigDecimal calculateDiscount(Order order);
}

@Component
public class VIPDiscountStrategy implements DiscountStrategy {
    public BigDecimal calculateDiscount(Order order) {
        return order.getAmount().multiply(new BigDecimal("0.2"));
    }
}

@Component
public class BulkDiscountStrategy implements DiscountStrategy {
    public BigDecimal calculateDiscount(Order order) {
        if (order.getItems().size() > 10) {
            return order.getAmount().multiply(new BigDecimal("0.1"));
        }
        return BigDecimal.ZERO;
    }
}

@Service
public class OrderService {
    private final Map<String, DiscountStrategy> discountStrategies;
    
    public BigDecimal calculateDiscount(Order order, String customerType) {
        DiscountStrategy strategy = discountStrategies.get(customerType);
        return strategy != null ? strategy.calculateDiscount(order) : BigDecimal.ZERO;
    }
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨Springç®¡ç†é…ç½®ï¼Œè€Œä¸æ˜¯å•ä¾‹
@Component
@ConfigurationProperties(prefix = "app")
public class AppConfiguration {
    private String name;
    private String version;
    
    // getters and setters
}
```

## 4.2.4 é»˜è®¤é…ç½®å®‰å…¨æ£€æŸ¥ ğŸ”´

### 4.2.4.1 é»˜è®¤è´¦æˆ·å’Œå¯†ç å®‰å…¨æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. é»˜è®¤è´¦æˆ·æ˜¯å¦å·²ç¦ç”¨æˆ–æ›´æ”¹ã€‚
b. é»˜è®¤å¯†ç æ˜¯å¦å·²ä¿®æ”¹ã€‚
c. æ˜¯å¦å­˜åœ¨å¼±å¯†ç ç­–ç•¥ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. é…ç½®æ–‡ä»¶æ‰«æã€‚
2. å®‰å…¨é…ç½®å®¡æŸ¥ã€‚
3. å¯†ç ç­–ç•¥æ£€æŸ¥ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```properties
# âŒ é”™è¯¯ï¼šä½¿ç”¨é»˜è®¤è´¦æˆ·å’Œå¯†ç 
spring.datasource.username=root
spring.datasource.password=password

# âŒ é”™è¯¯ï¼šç®¡ç†å‘˜è´¦æˆ·ä½¿ç”¨å¼±å¯†ç 
admin.username=admin
admin.password=123456

# âŒ é”™è¯¯ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ˜æ–‡å­˜å‚¨å¯†ç 
redis.password=myredispassword
```

```java
// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç é»˜è®¤å‡­æ®
@Configuration
public class DatabaseConfig {
    @Bean
    public DataSource dataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setUsername("sa"); // é»˜è®¤ç”¨æˆ·å
        dataSource.setPassword(""); // ç©ºå¯†ç 
        return dataSource;
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```properties
# âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–åŠ å¯†é…ç½®
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# âœ… æ­£ç¡®ï¼šä½¿ç”¨é…ç½®åŠ å¯†
spring.datasource.password=ENC(encrypted_password_here)

# âœ… æ­£ç¡®ï¼šå¼ºå¯†ç ç­–ç•¥é…ç½®
password.policy.min-length=12
password.policy.require-uppercase=true
password.policy.require-lowercase=true
password.policy.require-numbers=true
password.policy.require-special-chars=true
```

```java
// âœ… æ­£ç¡®ï¼šä»å®‰å…¨é…ç½®ä¸­è·å–å‡­æ®
@Configuration
public class DatabaseConfig {
    @Value("${spring.datasource.username}")
    private String username;
    
    @Value("${spring.datasource.password}")
    private String password;
    
    @Bean
    public DataSource dataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        return dataSource;
    }
}

// âœ… æ­£ç¡®ï¼šå¯†ç ç­–ç•¥éªŒè¯
@Component
public class PasswordValidator {
    private static final String PASSWORD_PATTERN = 
        "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{12,}$";
    
    public boolean isValidPassword(String password) {
        return password != null && password.matches(PASSWORD_PATTERN);
    }
}
```

### 4.2.4.2 å®‰å…¨åŠŸèƒ½é»˜è®¤å¯ç”¨æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. HTTPSæ˜¯å¦é»˜è®¤å¯ç”¨ã€‚
b. CSRFä¿æŠ¤æ˜¯å¦å¼€å¯ã€‚
c. å®‰å…¨å¤´æ˜¯å¦é…ç½®ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. å®‰å…¨é…ç½®æ£€æŸ¥ã€‚
2. HTTPå“åº”å¤´åˆ†æã€‚
3. SSL/TLSé…ç½®éªŒè¯ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```java
// âŒ é”™è¯¯ï¼šç¦ç”¨å®‰å…¨åŠŸèƒ½
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf().disable() // âŒ ç¦ç”¨CSRFä¿æŠ¤
            .headers().frameOptions().disable() // âŒ ç¦ç”¨X-Frame-Options
            .and()
            .authorizeRequests()
            .anyRequest().permitAll(); // âŒ å…è®¸æ‰€æœ‰è¯·æ±‚
        return http.build();
    }
}

// âŒ é”™è¯¯ï¼šHTTPé…ç½®
server.port=8080
# æ²¡æœ‰HTTPSé…ç½®
```

**4. æ­£ç¡®ç¤ºä¾‹**

```java
// âœ… æ­£ç¡®ï¼šå¯ç”¨å®‰å…¨åŠŸèƒ½
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())
            .and()
            .headers(headers -> headers
                .frameOptions().deny()
                .contentTypeOptions().and()
                .httpStrictTransportSecurity(hstsConfig -> hstsConfig
                    .maxAgeInSeconds(31536000)
                    .includeSubdomains(true)
                )
            )
            .sessionManagement()
            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and()
            .authorizeRequests()
            .antMatchers("/public/**").permitAll()
            .anyRequest().authenticated();
        return http.build();
    }
}

// âœ… æ­£ç¡®ï¼šHTTPSé…ç½®
server.port=8443
server.ssl.enabled=true
server.ssl.key-store=${SSL_KEYSTORE_PATH}
server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD}
server.ssl.key-store-type=PKCS12

# HTTPé‡å®šå‘åˆ°HTTPS
server.http.port=8080
security.require-ssl=true
```

### 4.2.4.3 æ•æ„Ÿä¿¡æ¯é…ç½®æ£€æŸ¥

**1. æ£€æµ‹ç›®æ ‡**

a. é…ç½®æ–‡ä»¶æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚
b. å¯†é’¥æ˜¯å¦å®‰å…¨å­˜å‚¨ã€‚
c. æ˜¯å¦æœ‰ä¿¡æ¯æ³„éœ²é£é™©ã€‚

**2. æ£€æµ‹æ–¹æ³•**

1. é…ç½®æ–‡ä»¶æ‰«æã€‚
2. æ•æ„Ÿä¿¡æ¯æ£€æµ‹å·¥å…·ã€‚
3. ä»£ç å®¡æŸ¥ã€‚

**3. é”™è¯¯ç¤ºä¾‹**

```properties
# âŒ é”™è¯¯ï¼šé…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯
spring.datasource.password=MySecretPassword123
aws.access-key=AKIAIOSFODNN7EXAMPLE
aws.secret-key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
jwt.secret=myJwtSecretKey
api.key=sk-1234567890abcdef

# âŒ é”™è¯¯ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®
spring.profiles.active=prod
logging.level.org.springframework.security=DEBUG
management.endpoints.web.exposure.include=*
```

```java
// âŒ é”™è¯¯ï¼šä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
@Service
public class PaymentService {
    private static final String API_KEY = "sk-live_1234567890abcdef"; // âŒ ç¡¬ç¼–ç APIå¯†é’¥
    private static final String SECRET = "mySecretKey123"; // âŒ ç¡¬ç¼–ç å¯†é’¥
    
    public void processPayment(PaymentRequest request) {
        // ä½¿ç”¨ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
    }
}
```

**4. æ­£ç¡®ç¤ºä¾‹**

```properties
# âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
spring.datasource.password=${DB_PASSWORD}
aws.access-key=${AWS_ACCESS_KEY}
aws.secret-key=${AWS_SECRET_KEY}
jwt.secret=${JWT_SECRET}
api.key=${PAYMENT_API_KEY}

# âœ… æ­£ç¡®ï¼šç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®
spring.profiles.active=${SPRING_PROFILES_ACTIVE:prod}
logging.level.org.springframework.security=WARN
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
```

```java
// âœ… æ­£ç¡®ï¼šä»é…ç½®ä¸­è·å–æ•æ„Ÿä¿¡æ¯
@Service
public class PaymentService {
    @Value("${payment.api.key}")
    private String apiKey;
    
    @Value("${payment.secret}")
    private String secret;
    
    public void processPayment(PaymentRequest request) {
        // ä½¿ç”¨ä»é…ç½®ä¸­è·å–çš„æ•æ„Ÿä¿¡æ¯
    }
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨é…ç½®ç±»ç®¡ç†æ•æ„Ÿä¿¡æ¯
@Component
@ConfigurationProperties(prefix = "payment")
public class PaymentConfig {
    private String apiKey;
    private String secret;
    private String webhookSecret;
    
    // getters and setters
    // æ³¨æ„ï¼štoString()æ–¹æ³•åº”è¯¥æ’é™¤æ•æ„Ÿå­—æ®µ
    @Override
    public String toString() {
        return "PaymentConfig{apiKey='***', secret='***', webhookSecret='***'}";
    }
}
```